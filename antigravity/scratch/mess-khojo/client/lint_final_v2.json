[{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\FeedbackForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\FilterBar.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  24 |         if (currentFilters) {\n  25 |             // eslint-disable-next-line\n> 26 |             setFilters(prev => {\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  27 |                 // Only update if there's a difference to avoid loops\n  28 |                 if (JSON.stringify(prev) !== JSON.stringify(currentFilters)) {\n  29 |                     return currentFilters;","line":26,"column":13,"nodeType":null,"endLine":26,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\Footer.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\Header.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  21 |         if (!currentUser) {\n  22 |             // eslint-disable-next-line\n> 23 |             setNotifications([]);\n     |             ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  24 |             return;\n  25 |         }\n  26 |","line":23,"column":13,"nodeType":null,"endLine":23,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\MapLocationModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\MapPicker.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\MessCard.jsx","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":51,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'mess.name'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [mess.name, mess.posterUrl]","fix":{"range":[2346,2362],"text":"[mess.name, mess.posterUrl]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\MessExplorer.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  18 |         if (userLocation?.lat && userLocation?.lng) {\n  19 |             // eslint-disable-next-line\n> 20 |             setMapCenter({ lat: userLocation.lat, lng: userLocation.lng });\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |         }\n  22 |     }, [userLocation]);\n  23 |","line":20,"column":13,"nodeType":null,"endLine":20,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\MultiSelectDropdown.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\PhoneCollectionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\RoomCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\components\\SkeletonCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'createContext' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"createContext"},"fix":{"range":[16,30],"text":""},"desc":"Remove unused variable 'createContext'."}]},{"ruleId":"no-undef","severity":2,"message":"'AuthContext' is not defined.","line":8,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":8,"endColumn":34}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":7,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":7,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport { auth, db } from \"../firebase\";\r\nimport { onAuthStateChanged, signOut as firebaseSignOut } from \"firebase/auth\";\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\n\r\n// eslint-disable-next-line react-refresh/only-export-components\r\nexport function useAuth() {\r\n    return useContext(AuthContext);\r\n}\r\n\r\nexport function AuthProvider({ children }) {\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const [userRole, setUserRole] = useState(null); // 'user' or 'admin' (can be null initially)\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n            if (user) {\r\n                setCurrentUser(user);\r\n                // Check user role from Firestore\r\n                try {\r\n                    const userDocRef = doc(db, \"users\", user.uid);\r\n                    const userDoc = await getDoc(userDocRef);\r\n\r\n                    if (userDoc.exists()) {\r\n                        const userData = userDoc.data();\r\n                        // Use the 'role' field from the document\r\n                        setUserRole(userData.role || 'user');\r\n                    } else {\r\n                        // Document doesn't exist yet - check if it's a partner/admin\r\n                        const messesRef = doc(db, \"messes\", user.uid);\r\n                        const messDoc = await getDoc(messesRef);\r\n\r\n                        if (messDoc.exists()) {\r\n                            setUserRole(\"admin\"); // Partner who owns a mess\r\n                        } else {\r\n                            // New user - document might be created soon\r\n                            // Wait a bit and check again\r\n                            setTimeout(async () => {\r\n                                const retryUserDoc = await getDoc(userDocRef);\r\n                                if (retryUserDoc.exists()) {\r\n                                    const retryUserData = retryUserDoc.data();\r\n                                    setUserRole(retryUserData.role || 'user');\r\n                                } else {\r\n                                    setUserRole('user'); // Default to user if still nothing\r\n                                }\r\n                            }, 1000);\r\n                        }\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Error fetching user role:\", error);\r\n                    setUserRole('user'); // Default to user on error\r\n                }\r\n            } else {\r\n                setCurrentUser(null);\r\n                setUserRole(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        return unsubscribe;\r\n    }, []);\r\n\r\n    const logout = () => {\r\n        return firebaseSignOut(auth);\r\n    };\r\n\r\n    const value = {\r\n        currentUser,\r\n        userRole, // Expose role so components know who is logged in\r\n        logout,\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {!loading && children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\AdminDashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\AdminLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\BookRoomComingSoon.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\BookingSuccess.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\Home.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[644,683],"text":""},"desc":"Remove unused variable 'motion'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useRef } from 'react';\r\nimport { collection, onSnapshot } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\nimport MessCard from '../components/MessCard';\r\nimport SkeletonCard from '../components/SkeletonCard';\r\nimport FilterBar from '../components/FilterBar';\r\nimport Header from '../components/Header'; // Import new Header\r\nimport FeedbackForm from '../components/FeedbackForm';\r\nimport MessExplorer from '../components/MessExplorer';\r\nimport MapLocationModal from '../components/MapLocationModal';\r\nimport { Search, MapPin, Home as HomeIcon, TrendingUp, ChevronDown } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\n\r\n// Helper functions moved outside component\r\nconst deg2rad = (deg) => {\r\n    return deg * (Math.PI / 180);\r\n};\r\n\r\nconst calculateDistance = (lat1, lon1, lat2, lon2) => {\r\n    const x1 = Number(lat1);\r\n    const y1 = Number(lon1);\r\n    const x2 = Number(lat2);\r\n    const y2 = Number(lon2);\r\n\r\n    if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) return null;\r\n\r\n    const R = 6371; // Radius of earth in km\r\n    const dLat = deg2rad(x2 - x1);\r\n    const dLon = deg2rad(y2 - y1);\r\n\r\n    // Haversine formula\r\n    const a =\r\n        Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n        Math.cos(deg2rad(x1)) * Math.cos(deg2rad(x2)) *\r\n        Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n\r\n    // Clamp a between 0 and 1 to prevent precision issues causing NaN in sqrt\r\n    const c = 2 * Math.atan2(Math.sqrt(Math.max(0, Math.min(1, a))), Math.sqrt(Math.max(0, Math.min(1, 1 - a))));\r\n    return R * c; // Distance in km\r\n};\r\n\r\nconst Home = () => {\r\n    const [messes, setMesses] = useState([]);\r\n    const [rooms, setRooms] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [userLocation, setUserLocation] = useState(null); // { lat, lng, address }\r\n    const [filters, setFilters] = useState({\r\n        location: '',\r\n        minPrice: '',\r\n        maxPrice: '',\r\n        amenities: {\r\n            wifi: false,\r\n            ac: false,\r\n            food: false,\r\n            inverter: false,\r\n            tableChair: false\r\n        },\r\n        availableOnly: false,\r\n        messType: '',\r\n        messName: ''\r\n    });\r\n    const [showMapModal, setShowMapModal] = useState(false);\r\n    const [isLocationModalOpen, setIsLocationModalOpen] = useState(false);\r\n    const [displayCount, setDisplayCount] = useState(12); // Pagination: show 12 cards initially\r\n\r\n    const [loadingLocation, setLoadingLocation] = useState(false);\r\n\r\n\r\n    const isScrolledRef = useRef(false);\r\n\r\n    const handleOpenMap = () => {\r\n        window.history.pushState({ ...window.history.state, mapModalOpen: true }, \"\");\r\n        setShowMapModal(true);\r\n    };\r\n\r\n    const handleCloseMap = () => {\r\n        window.history.back();\r\n    };\r\n\r\n    // Scroll-Back Behavior Logic\r\n    useEffect(() => {\r\n        // Prevent browser from auto-restoring scroll on history navigation\r\n        // This stops the \"jump\" when we call history.back() during manual scrolling\r\n        if ('scrollRestoration' in window.history) {\r\n            window.history.scrollRestoration = 'manual';\r\n        }\r\n\r\n        // Sync ref with initial history state on mount\r\n        isScrolledRef.current = !!window.history.state?.scrolled;\r\n\r\n        const handleScroll = () => {\r\n            // If user scrolls down > 300px and we haven't marked it yet, push state\r\n            // Don't push scroll state if a modal is open (it might clutter history or be confusing)\r\n            // Actually, we want to know if WE are scrolled underlying the modal.\r\n            if (window.scrollY > 300) {\r\n                if (!isScrolledRef.current) {\r\n                    window.history.pushState({ ...window.history.state, scrolled: true }, \"\");\r\n                    isScrolledRef.current = true;\r\n                }\r\n            }\r\n            // If user manually scrolls back to top (< 100px) and we have state, pop it\r\n            // This ensures \"Back\" at top exits app instead of doing nothing\r\n            else if (window.scrollY < 100) {\r\n                // Check ACTUAL history state, not just our ref logic, to be safe\r\n                if (window.history.state?.scrolled) {\r\n                    // isScrolledRef.current = false; // We don't need to lock this anymore with manual restoration\r\n                    window.history.back();\r\n                }\r\n            }\r\n        };\r\n\r\n        const handlePopState = (event) => {\r\n            // Sync our local ref with the actual history state\r\n            const state = event.state || {}; // Ensure state is object\r\n            const isScrolled = !!state.scrolled;\r\n            isScrolledRef.current = isScrolled;\r\n\r\n            // Map Modal Close Logic (Home Hero)\r\n            if (!state.mapModalOpen && showMapModal) {\r\n                setShowMapModal(false);\r\n            }\r\n\r\n            // When back button is pressed (or we programmatically went back):\r\n            // If we are back to base state (no 'scrolled'), scroll to top\r\n            if (!isScrolled) {\r\n                // Only clean up scroll if we are actually scrolled down significantly.\r\n                // If user is already near top (started manual scroll up), don't force it.\r\n                // Also, DON'T scroll top if we just closed a modal (which might still be 'scrolled')\r\n                // Wait, if we closed a modal, we might have popped 'mapModalOpen' but KEPT 'scrolled' if we pushed correct state.\r\n                // If we preserved 'scrolled' in handleOpenMap, then 'isScrolled' will be true here, so we won't scroll top. Correct.\r\n\r\n                if (window.scrollY > 100) {\r\n                    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('scroll', handleScroll);\r\n        window.addEventListener('popstate', handlePopState);\r\n\r\n        return () => {\r\n            window.removeEventListener('scroll', handleScroll);\r\n            window.removeEventListener('popstate', handlePopState);\r\n        };\r\n    }, [showMapModal]); // Added dependency on showMapModal to access current state in listener\r\n\r\n    const CARDS_PER_PAGE = 12;\r\n\r\n\r\n\r\n\r\n    const handleLocationSelect = (coords) => {\r\n        if (coords) {\r\n            // Coordinate object provided (from MapPicker)\r\n\r\n            setUserLocation({\r\n                lat: coords.lat,\r\n                lng: coords.lng,\r\n                address: coords.address || \"Pinned Location\"\r\n            });\r\n            setFilters(prev => ({ ...prev, location: '' }));\r\n            return;\r\n        }\r\n\r\n        // GPS Logic with Retry\r\n\r\n        setLoadingLocation(true); // Start Loading\r\n        if (navigator.geolocation) {\r\n            const successCallback = (position) => {\r\n                let { latitude, longitude } = position.coords;\r\n\r\n\r\n                // AUTO-CORRECT: If GPS places user in Bhubaneswar/Cuttack region (Lat ~19.8 - 20.8), override to Baleshwar center\r\n                // This ensures testers in the capital see meaningful Baleshwar distances\r\n                if (latitude > 19.8 && latitude < 20.9) {\r\n\r\n                    latitude = 21.4934;\r\n                    longitude = 86.9294;\r\n                }\r\n\r\n                setUserLocation({\r\n                    lat: latitude,\r\n                    lng: longitude,\r\n                    address: \"Your Location\"\r\n                });\r\n                setFilters(prev => ({ ...prev, location: '' }));\r\n\r\n                setLoadingLocation(false); // Stop Loading\r\n            };\r\n\r\n            const errorCallback = (error, isRetry = false) => {\r\n                console.error(`âŒ Geolocation error (${isRetry ? 'Low' : 'High'} Accuracy):`, error.code, error.message);\r\n\r\n                // If High Accuracy failed, try Low Accuracy once\r\n                if (!isRetry) {\r\n\r\n                    navigator.geolocation.getCurrentPosition(\r\n                        successCallback,\r\n                        (finalError) => errorCallback(finalError, true),\r\n                        { enableHighAccuracy: false, timeout: 10000, maximumAge: 300000 }\r\n                    );\r\n                    return;\r\n                }\r\n\r\n                // Final Failure Handling\r\n                setLoadingLocation(false); // Stop Loading on Error\r\n                let errorMessage = \"Unable to get your location.\\n\\n\";\r\n                switch (error.code) {\r\n                    case error.PERMISSION_DENIED:\r\n                        errorMessage += \"âŒ Location permission denied.\\n\\nPlease:\\n1. Click the location icon in your browser's address bar\\n2. Allow location access\\n3. Try again\";\r\n                        console.error(\"User denied location permission\");\r\n                        break;\r\n                    case error.POSITION_UNAVAILABLE:\r\n                        errorMessage += \"ðŸ“ Location unavailable.\\n\\nPlease use 'Select on Map' instead.\";\r\n                        console.error(\"Position unavailable\");\r\n                        break;\r\n                    case error.TIMEOUT:\r\n                        errorMessage += \"â±ï¸ Request timed out.\\n\\nPlease:\\n1. Check your GPS/location services\\n2. Try 'Select on Map' instead\";\r\n                        console.error(\"Geolocation timeout\");\r\n                        break;\r\n                    default:\r\n                        errorMessage += \"Please use 'Select on Map' to choose your location.\";\r\n                        console.error(\"Unknown geolocation error:\", error);\r\n                }\r\n                alert(errorMessage);\r\n            };\r\n\r\n            // 1. Try High Accuracy first\r\n            console.log(\"ðŸ“ Attempting high accuracy GPS...\");\r\n            navigator.geolocation.getCurrentPosition(\r\n                successCallback,\r\n                (err) => errorCallback(err, false),\r\n                { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }\r\n            );\r\n\r\n        } else {\r\n            console.error(\"âŒ Geolocation not supported by browser\");\r\n            setLoadingLocation(false);\r\n            alert(\"Your browser doesn't support location services.\\n\\nPlease use 'Select on Map' instead.\");\r\n        }\r\n    };\r\n\r\n    // Auto-detect location on load (optional, better UX to ask first or just button)\r\n    // useEffect(() => { handleLocationSelect(); }, []);\r\n\r\n    useEffect(() => {\r\n        // Fetch Messes\r\n        const unsubscribeMesses = onSnapshot(collection(db, \"messes\"), (snapshot) => {\r\n            const messesData = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data()\r\n            }));\r\n            setMesses(messesData);\r\n        });\r\n\r\n        // Fetch Rooms\r\n        const unsubscribeRooms = onSnapshot(collection(db, \"rooms\"), (snapshot) => {\r\n            const roomsData = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data()\r\n            }));\r\n            setRooms(roomsData);\r\n            setLoading(false);\r\n        });\r\n\r\n        return () => {\r\n            unsubscribeMesses();\r\n            unsubscribeRooms();\r\n        };\r\n    }, []);\r\n\r\n    const handleFilterChange = React.useCallback((newFilters) => {\r\n        setFilters(newFilters);\r\n    }, []);\r\n\r\n    // Filtering & Sorting Logic - Memoized for Performance\r\n    const filteredMesses = React.useMemo(() => {\r\n        console.log(\"Recalculating with User Location:\", userLocation);\r\n        let result = messes.map(mess => {\r\n            // Calculate Distance FIRST if userLocation exists\r\n            // Calculate Distance FIRST if userLocation exists\r\n            let distance = null;\r\n            if (userLocation?.lat && userLocation?.lng && mess.latitude && mess.longitude) {\r\n                // Strict number conversion\r\n                const lat1 = Number(userLocation.lat);\r\n                const lng1 = Number(userLocation.lng);\r\n                const lat2 = Number(mess.latitude);\r\n                const lng2 = Number(mess.longitude);\r\n\r\n                if (!isNaN(lat1) && !isNaN(lng1) && !isNaN(lat2) && !isNaN(lng2)) {\r\n                    distance = calculateDistance(lat1, lng1, lat2, lng2);\r\n                } else {\r\n                    console.warn(`Invalid coords for ${mess.name}:`, { lat1, lng1, lat2, lng2 });\r\n                }\r\n            }\r\n\r\n            const messWithDist = { ...mess, distance };\r\n\r\n            // Visibility Filter\r\n            if (mess.hidden) return null;\r\n\r\n            // 1. Location Filter (Mess Name Only)\r\n            if (filters.location) {\r\n                const searchTerm = filters.location.toLowerCase();\r\n                const matchesName = (mess.name || '').toLowerCase().includes(searchTerm);\r\n                if (!matchesName) return null;\r\n            }\r\n\r\n            // 2. Mess Type Filter (Gender)\r\n            if (filters.messType && filters.messType !== '') {\r\n                if (mess.messType !== filters.messType) return null;\r\n            }\r\n\r\n\r\n\r\n            // Get rooms for this mess\r\n            const messRooms = rooms.filter(room => room.messId === mess.id);\r\n\r\n            // Calculate Price Range for display (Global for Mess)\r\n            const prices = messRooms.map(r => Number(r.price || r.rent)).filter(p => !isNaN(p) && p > 0);\r\n            const minPrice = prices.length ? Math.min(...prices) : null;\r\n            const maxPrice = prices.length ? Math.max(...prices) : null;\r\n\r\n            // Helper to check amenity (Mess Level > Fallback to Room Level for legacy data)\r\n            const checkAmenity = (key) => {\r\n                // 1. Check new Mess-level amenities\r\n                if (mess.amenities && mess.amenities[key] !== undefined) return mess.amenities[key];\r\n\r\n                // 2. Fallback: Check if ANY room has this feature (Migration support)\r\n                return messRooms.some(r => {\r\n                    const rAm = r.amenities || r;\r\n                    return rAm[key] === true;\r\n                });\r\n            };\r\n\r\n            // 2a. Mess-Level Amenities Filter\r\n            if (filters.amenities.food && !checkAmenity('food')) return null;\r\n            if (filters.amenities.wifi && !checkAmenity('wifi')) return null;\r\n            if (filters.amenities.inverter && !checkAmenity('inverter')) return null;\r\n\r\n            // Filter Rooms based on Room Criteria for COUNTING\r\n            const matchingRooms = messRooms.filter(room => {\r\n                const price = Number(room.price || room.rent);\r\n                const amenities = room.amenities || room;\r\n\r\n                // Price\r\n                if (filters.minPrice && price < Number(filters.minPrice)) return false;\r\n                if (filters.maxPrice && price > Number(filters.maxPrice)) return false;\r\n\r\n                // Room Amenities\r\n                if (filters.amenities.ac && !amenities.ac) return false;\r\n\r\n                // Availability\r\n                if (filters.availableOnly && (room.availableCount === 0 || room.available === false)) return false;\r\n\r\n                return true;\r\n            });\r\n\r\n            const hasRoomCriteria = filters.minPrice || filters.maxPrice || filters.availableOnly || filters.amenities.ac;\r\n\r\n            // If filtering by room criteria, and no rooms match, exclude mess\r\n            if (hasRoomCriteria && matchingRooms.length === 0) return null;\r\n\r\n            // Calculate Total Matching Beds\r\n            const matchingBeds = matchingRooms.reduce((sum, room) => sum + (room.availableCount || 0), 0);\r\n\r\n            // Determine if we should show the \"Filtered Availability\" badge\r\n            const isFiltered = filters.location || filters.minPrice || filters.maxPrice || filters.availableOnly || filters.messType || filters.maxDistance || Object.values(filters.amenities).some(Boolean);\r\n\r\n            return {\r\n                ...messWithDist,\r\n                matchingBeds,\r\n                isFiltered,\r\n                minPrice,\r\n                maxPrice\r\n            };\r\n        }).filter(Boolean); // Remove nulls\r\n\r\n        // Sort by Distance if userLocation exists (Default Sort)\r\n        if (userLocation) {\r\n            result.sort((a, b) => {\r\n                const distA = (typeof a.distance === 'number') ? a.distance : Infinity;\r\n                const distB = (typeof b.distance === 'number') ? b.distance : Infinity;\r\n                return distA - distB;\r\n            });\r\n        } else {\r\n            // Default Sort: Priority to visual content -> Alphabetical\r\n            result.sort((a, b) => {\r\n                // 1. Priority: Has Poster Image\r\n                const hasPosterA = !!a.posterUrl && a.posterUrl.length > 5;\r\n                const hasPosterB = !!b.posterUrl && b.posterUrl.length > 5;\r\n                if (hasPosterA !== hasPosterB) return hasPosterB ? 1 : -1;\r\n\r\n                // 2. Priority: Total Images Available (excluding placeholders)\r\n                const countImages = (item) => {\r\n                    if (!Array.isArray(item.images)) return 0;\r\n                    return item.images.filter(url => url && typeof url === 'string' && url.length > 10 && !url.includes('placeholder')).length;\r\n                };\r\n                const countA = countImages(a);\r\n                const countB = countImages(b);\r\n                if (countA !== countB) return countB - countA;\r\n\r\n                // 3. Priority: Alphabetical Order\r\n                return (a.name || '').localeCompare(b.name || '');\r\n            });\r\n        }\r\n\r\n        return result;\r\n\r\n    }, [messes, rooms, filters, userLocation]);\r\n\r\n    // Paginated messes for display\r\n    const displayedMesses = filteredMesses.slice(0, displayCount);\r\n    const hasMore = displayCount < filteredMesses.length;\r\n\r\n    const loadMore = () => {\r\n        setDisplayCount(prev => prev + CARDS_PER_PAGE);\r\n    };\r\n\r\n    // Reset pagination when filters change\r\n    useEffect(() => {\r\n        setDisplayCount(CARDS_PER_PAGE);\r\n    }, [filters, userLocation]);\r\n\r\n    const [isMainSearchVisible, setIsMainSearchVisible] = useState(true);\r\n    const filterBarRef = React.useRef(null);\r\n\r\n    useEffect(() => {\r\n        const observer = new IntersectionObserver(\r\n            ([entry]) => {\r\n                // If the filter bar is NOT intersecting (scrolled out of view), show the main header search\r\n                // Use a slight delay or debounce if flickering occurs, but direct state setting is usually fine here\r\n                setIsMainSearchVisible(entry.isIntersecting);\r\n            },\r\n            {\r\n                threshold: 0, // Trigger as soon as one pixel leaves (or enters)\r\n                rootMargin: \"-80px 0px 0px 0px\" // Offset by approx header height so it triggers when it goes under header\r\n            }\r\n        );\r\n\r\n        const currentRef = filterBarRef.current;\r\n        if (currentRef) {\r\n            observer.observe(currentRef);\r\n        }\r\n\r\n        return () => {\r\n            if (currentRef) {\r\n                observer.unobserve(currentRef);\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-brand-secondary font-sans text-brand-text-dark pb-20\">\r\n            {/* New Header */}\r\n            <Header\r\n                userLocation={userLocation}\r\n                onLocationSelect={handleLocationSelect}\r\n                isLocationModalOpen={isLocationModalOpen}\r\n                setIsLocationModalOpen={setIsLocationModalOpen}\r\n                showSearch={!isMainSearchVisible}\r\n                searchTerm={filters.location}\r\n                onSearchChange={(val) => setFilters(prev => ({ ...prev, location: val }))}\r\n            />\r\n\r\n            {/* Filter Section - Moved to Top */}\r\n            <div ref={filterBarRef} className=\"pt-2 pb-6 relative z-40\">\r\n                <FilterBar onFilterChange={handleFilterChange} currentFilters={filters} />\r\n            </div>\r\n\r\n            {/* Mess Explorer Map Banner */}\r\n            <MessExplorer messes={messes} userLocation={userLocation} />\r\n\r\n            {/* Spotlight Hero Section - Only show when no filters are active */}\r\n            {!filters.location && !filters.messType && !filters.minPrice && !filters.maxPrice && !filters.availableOnly && !Object.values(filters.amenities).some(Boolean) && (\r\n                <div className=\"px-4 sm:px-6 lg:px-8 mb-8 max-w-7xl mx-auto\">\r\n                    <div\r\n                        className=\"w-full h-[38vh] flex items-center justify-center overflow-hidden relative rounded-3xl shadow-lg\"\r\n                    >\r\n                        {/* Brand gradient overlay for hero section */}\r\n                        <div className=\"absolute inset-0 bg-gradient-to-br from-brand-primary/95 to-brand-primary/80 rounded-3xl\"></div>\r\n\r\n                        {/* Content positioned below spotlights */}\r\n                        <div className=\"relative z-10 text-center px-6 max-w-2xl\">\r\n                            <h1 className=\"text-3xl md:text-4xl font-bold text-white mb-3 leading-tight\">\r\n                                Find your comfortable <span className=\"text-brand-accent-green\">stay</span>\r\n                            </h1>\r\n                            <p className=\"text-white/90 font-medium mb-6 text-base\">\r\n                                Mess Dhundo, Ghar Baithe\r\n                            </p>\r\n\r\n\r\n                            {!userLocation && (\r\n                                <div className=\"relative max-w-xs mx-auto\">\r\n                                    <div className=\"grid grid-cols-2 gap-3 w-full\">\r\n                                        <button\r\n                                            onClick={() => handleLocationSelect()}\r\n                                            disabled={loadingLocation}\r\n                                            className=\"w-full py-2.5 px-3 bg-white/20 backdrop-blur-md text-white text-sm font-medium rounded-xl border border-white/30 hover:bg-white/30 transition-all flex items-center justify-center gap-2 shadow-md hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                        >\r\n                                            <MapPin size={16} className=\"fill-current\" />\r\n                                            <span>{loadingLocation ? 'Locating...' : 'Use GPS'}</span>\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={handleOpenMap}\r\n                                            className=\"w-full py-2.5 px-3 bg-brand-primary text-white text-sm font-medium rounded-xl border border-transparent hover:bg-brand-primary-hover transition-all flex items-center justify-center gap-2 shadow-md hover:scale-[1.02] active:scale-[0.98]\"\r\n                                        >\r\n                                            <MapPin size={16} />\r\n                                            <span>Map</span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n\r\n                            {userLocation && (\r\n                                <div className=\"mt-4 flex flex-col items-center animate-fade-in-up\">\r\n                                    <span className=\"text-xs font-bold text-white/70 uppercase tracking-wider mb-2\">Location Active</span>\r\n                                    <button\r\n                                        onClick={() => setIsLocationModalOpen(true)}\r\n                                        className=\"px-6 py-2 bg-white/20 backdrop-blur-md rounded-xl border border-white/30 text-white font-bold flex items-center gap-2 shadow-lg hover:bg-white/30 transition-all hover:scale-105 active:scale-95\"\r\n                                    >\r\n                                        <MapPin size={16} className=\"text-brand-accent-green\" />\r\n                                        {userLocation.address || \"Using GPS Location\"}\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Social Proof Stats - Option 3: Clean Inline Text */}\r\n                            <div className=\"mt-5 flex items-center justify-center gap-6 animate-fade-in-up\" style={{ animationDelay: '0.1s' }}>\r\n                                <div className=\"flex items-center gap-2 text-white/90\">\r\n                                    <div className=\"w-1.5 h-1.5 rounded-full bg-brand-accent-green shadow-[0_0_8px_rgba(34,197,94,0.6)]\"></div>\r\n                                    <span className=\"text-sm font-medium tracking-wide shadow-sm\">{messes.length >= 10 ? (Math.floor(messes.length / 10) * 10) + \"+\" : messes.length} Messes Listed</span>\r\n                                </div>\r\n                                <div className=\"w-px h-4 bg-white/20\"></div>\r\n                                <div className=\"flex items-center gap-2 text-white/90\">\r\n                                    <span className=\"text-sm font-medium tracking-wide shadow-sm\">âœ¨ Free Bookings</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Mess List */}\r\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-20\">\r\n                <div className=\"flex items-center justify-between mb-4 px-1\">\r\n                    {/* Category Switcher */}\r\n                    <div className=\"flex bg-white p-1 rounded-xl border border-gray-100 shadow-sm\">\r\n                        {['All', 'Boys', 'Girls'].map((type) => {\r\n                            const isActive = (filters.messType || 'All') === type;\r\n                            return (\r\n                                <button\r\n                                    key={type}\r\n                                    onClick={() => handleFilterChange({ ...filters, messType: type === 'All' ? '' : type })}\r\n                                    className=\"relative px-4 py-1.5 text-sm font-medium rounded-lg transition-colors z-10\"\r\n                                >\r\n                                    {isActive && (\r\n                                        <motion.div\r\n                                            layoutId={`activeTab-${!filters.location && !filters.messType && !filters.minPrice && !filters.maxPrice && !filters.availableOnly && !Object.values(filters.amenities).some(Boolean) ? 'hero' : 'no-hero'}`}\r\n                                            className=\"absolute inset-0 bg-brand-primary rounded-lg -z-10\"\r\n                                            transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\r\n                                        />\r\n                                    )}\r\n                                    <span className={isActive ? 'text-white' : 'text-gray-500 hover:text-gray-700'}>\r\n                                        {type}\r\n                                    </span>\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col items-end\">\r\n                        <span className=\"text-xs text-gray-500 bg-white px-2 py-1 rounded-lg border border-gray-100\">\r\n                            {filteredMesses.length} results\r\n                        </span>\r\n                        {filters.location && !userLocation && (\r\n                            <span className=\"text-[10px] text-gray-400 mt-1 italic\">\r\n                                Enable \"Current Location\" for distances\r\n                            </span>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6\">\r\n                        {[...Array(6)].map((_, i) => (\r\n                            <SkeletonCard key={i} />\r\n                        ))}\r\n                    </div>\r\n                ) : filteredMesses.length > 0 ? (\r\n                    <motion.div\r\n                        className=\"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6\"\r\n                        initial=\"hidden\"\r\n                        animate=\"visible\"\r\n                        variants={{\r\n                            visible: {\r\n                                transition: {\r\n                                    staggerChildren: 0.05\r\n                                }\r\n                            }\r\n                        }}\r\n                    >\r\n                        {displayedMesses.map((mess, index) => (\r\n                            <MessCard key={mess.id} mess={mess} index={index} />\r\n                        ))}\r\n                    </motion.div>\r\n                ) : (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, scale: 0.9 }}\r\n                        animate={{ opacity: 1, scale: 1 }}\r\n                        transition={{ duration: 0.4 }}\r\n                        className=\"text-center py-16 px-6 bg-gradient-to-br from-white via-purple-50/30 to-white rounded-3xl border border-purple-100 shadow-lg\"\r\n                    >\r\n                        <motion.div\r\n                            animate={{\r\n                                rotate: [0, 10, -10, 10, 0],\r\n                                scale: [1, 1.1, 1, 1.1, 1]\r\n                            }}\r\n                            transition={{\r\n                                duration: 2,\r\n                                repeat: Infinity,\r\n                                repeatDelay: 3\r\n                            }}\r\n                            className=\"bg-gradient-to-br from-purple-100 to-purple-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-md\"\r\n                        >\r\n                            <Search size={32} className=\"text-purple-400\" />\r\n                        </motion.div>\r\n                        <h3 className=\"text-xl font-bold text-gray-800 mb-2\">No messes found</h3>\r\n                        <p className=\"text-sm text-gray-600 mb-6\">Try adjusting your filters or search criteria.</p>\r\n\r\n                        <div className=\"bg-purple-50/50 rounded-2xl p-4 border border-purple-100 max-w-md mx-auto\">\r\n                            <div className=\"flex items-center gap-2 mb-3 justify-center\">\r\n                                <TrendingUp size={16} className=\"text-purple-500\" />\r\n                                <span className=\"text-xs font-bold text-purple-700 uppercase tracking-wide\">Suggestions</span>\r\n                            </div>\r\n                            <ul className=\"text-sm text-left text-gray-700 space-y-2\">\r\n                                <li className=\"flex items-start gap-2\">\r\n                                    <span className=\"text-purple-500 mt-0.5\">â€¢</span>\r\n                                    <span>Try removing some filters</span>\r\n                                </li>\r\n                                <li className=\"flex items-start gap-2\">\r\n                                    <span className=\"text-purple-500 mt-0.5\">â€¢</span>\r\n                                    <span>Search by other mess name</span>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </div>\r\n\r\n            {/* View More Button */}\r\n            {!loading && hasMore && (\r\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-20\">\r\n                    <div className=\"flex justify-center my-8\">\r\n                        <button\r\n                            onClick={loadMore}\r\n                            className=\"group px-6 py-2.5 bg-brand-primary text-white rounded-xl font-bold transition-all shadow-md hover:shadow-lg hover:bg-brand-primary/90 hover:scale-105 active:scale-95 flex items-center gap-2\"\r\n                        >\r\n                            View More\r\n                            <ChevronDown size={20} className=\"group-hover:translate-y-1 transition-transform duration-300\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n\r\n            {/* Feedback Section */}\r\n            <div id=\"feedback-section\" className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-20\">\r\n                <FeedbackForm />\r\n            </div>\r\n\r\n            {/* Map Location Modal */}\r\n            {showMapModal && (\r\n                <MapLocationModal\r\n                    initialLocation={userLocation}\r\n                    onLocationSelect={(location) => {\r\n                        setUserLocation(location);\r\n                        // We must close carefully. If we push state to open, we must pop to close.\r\n                        // But setting state directly to false leaves history dirty.\r\n                        handleCloseMap();\r\n                        // Note: handleCloseMap triggers popstate -> sets showMapModal(false)\r\n                    }}\r\n                    onClose={handleCloseMap}\r\n                />\r\n            )}\r\n\r\n            {/* GPS Loader Overlay */}\r\n            {loadingLocation && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm\">\r\n                    <div className=\"bg-white rounded-2xl p-6 flex flex-col items-center shadow-2xl animate-in fade-in zoom-in duration-300\">\r\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-brand-primary border-t-transparent mb-4\"></div>\r\n                        <p className=\"text-brand-text-dark font-bold text-lg\">Locating...</p>\r\n                        <p className=\"text-sm text-gray-500\">Getting your best position</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Home;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\MessDetails.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\MessRegistration.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\OperationalDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":509,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":509,"endColumn":71},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":606,"column":66,"nodeType":"Identifier","messageId":"unusedVar","endLine":606,"endColumn":67},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":717,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":717,"endColumn":75},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":733,"column":82,"nodeType":"Identifier","messageId":"unusedVar","endLine":733,"endColumn":83},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":784,"column":66,"nodeType":"Identifier","messageId":"unusedVar","endLine":784,"endColumn":67},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":917,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":917,"endColumn":71},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":933,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":933,"endColumn":79},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":1001,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":1001,"endColumn":75}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { db, auth, secondaryAuth, storage } from '../firebase';\r\nimport { createUserWithEmailAndPassword, signOut } from 'firebase/auth';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { collection, query, onSnapshot, updateDoc, doc, serverTimestamp, deleteDoc } from 'firebase/firestore';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Server, Users, Calendar, LogOut, CheckCircle, XCircle, UserPlus, Shield, Briefcase, ClipboardCheck, Trash2, Phone, Eye, EyeOff, Edit3, Search, Database, Layout, MapPin, MessageSquare, Reply, Building2, BedDouble } from 'lucide-react';\r\nimport MultiSelectDropdown from '../components/MultiSelectDropdown';\r\n\r\nconst OperationalDashboard = () => {\r\n    const [activeTab, setActiveTab] = useState('bookings'); // 'bookings', 'partners', 'claims', 'inquiries', 'feedbacks', 'messes', 'rooms'\r\n    const [bookings, setBookings] = useState([]);\r\n    const [claims, setClaims] = useState([]);\r\n    const [inquiries, setInquiries] = useState([]);\r\n    const [roomInquiries, setRoomInquiries] = useState([]);\r\n    const [feedbacks, setFeedbacks] = useState([]);\r\n    const [feedbackReplies, setFeedbackReplies] = useState({}); // { feedbackId: replyText }\r\n    const [registrations, setRegistrations] = useState([]);\r\n    const [messes, setMesses] = useState([]);\r\n    const [rooms, setRooms] = useState([]);\r\n    const [bookingRemarks, setBookingRemarks] = useState({}); // { bookingId: remarkText }\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n\r\n    // Editing State\r\n    const [editingItem, setEditingItem] = useState(null); // For mess/room edit modal\r\n    const [editForm, setEditForm] = useState(null);\r\n    const [editImageFiles, setEditImageFiles] = useState([]);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [revealedIds, setRevealedIds] = useState({}); // { bookingId: true/false } to toggle phone visibility\r\n\r\n    // Partner Creation State\r\n    const [partnerEmail, setPartnerEmail] = useState('');\r\n    const [partnerPassword, setPartnerPassword] = useState('');\r\n    const [partnerStatus, setPartnerStatus] = useState({ type: '', msg: '' });\r\n\r\n    const navigate = useNavigate();\r\n\r\n    // Security Check\r\n    // Security Check & Reactive Auth Listener\r\n    // Security Check & Reactive Auth Listener\r\n    useEffect(() => {\r\n        const allowedEmail = import.meta.env.VITE_OP_EMAIL;\r\n\r\n        const unsubscribe = auth.onAuthStateChanged((user) => {\r\n            if (!user || user.email !== allowedEmail) {\r\n                // If user logs out or switches to a non-operator account in another tab\r\n                navigate('/operational/login');\r\n            }\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, [navigate]);\r\n\r\n    // Fetch ALL Bookings\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"bookings\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            // Sort by newest\r\n            data.sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds);\r\n            setBookings(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Claims\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"claims\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            data.sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds);\r\n            setClaims(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Inquiries\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"inquiries\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            data.sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds);\r\n            setInquiries(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Room Inquiries (For \"Book Room\" Coming Soon)\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"room_inquiries\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            data.sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds);\r\n            setRoomInquiries(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Feedbacks\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"feedbacks\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            data.sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds);\r\n            setFeedbacks(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Mess Registrations\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"mess_registrations\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            data.sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds);\r\n            setRegistrations(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Messes\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"messes\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            data.sort((a, b) => a.name.localeCompare(b.name));\r\n            setMesses(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Fetch ALL Rooms\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"rooms\"));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setRooms(data);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    const handleBookingAction = async (id, status) => {\r\n        try {\r\n            const remark = bookingRemarks[id] || \"\";\r\n            await updateDoc(doc(db, \"bookings\", id), {\r\n                status,\r\n                remark,\r\n                respondedAt: serverTimestamp()\r\n            });\r\n            // Clear remark for this booking after action\r\n            setBookingRemarks(prev => {\r\n                const updated = { ...prev };\r\n                delete updated[id];\r\n                return updated;\r\n            });\r\n        } catch (error) {\r\n            console.error(\"Update failed:\", error);\r\n            alert(\"Action failed\");\r\n        }\r\n    };\r\n\r\n    const handleToggleVisibility = async (id, currentHidden) => {\r\n        try {\r\n            await updateDoc(doc(db, \"messes\", id), {\r\n                hidden: !currentHidden\r\n            });\r\n        } catch (error) {\r\n            console.error(\"Toggle visibility failed:\", error);\r\n            alert(\"Action failed\");\r\n        }\r\n    };\r\n\r\n    const handleEditItem = (item, type) => {\r\n        setEditingItem({ type, id: item.id });\r\n        if (type === 'mess') {\r\n            setEditForm({\r\n                name: item.name || '',\r\n                address: item.address || '',\r\n                contact: item.contact || '',\r\n                locationUrl: item.locationUrl || '',\r\n                messType: item.messType || 'Boys',\r\n                extraAppliances: item.extraAppliances || '',\r\n                foodFacility: item.foodFacility || '',\r\n                security: item.security || '',\r\n                advanceDeposit: item.advanceDeposit || '',\r\n                isUserSourced: item.isUserSourced || false,\r\n                lastUpdatedDate: item.lastUpdatedDate || '',\r\n                hidden: item.hidden || false,\r\n                hideContact: item.hideContact || false,\r\n                posterUrl: item.posterUrl || '',\r\n                amenities: item.amenities || { food: false, wifi: false, inverter: false }\r\n            });\r\n        } else {\r\n            setEditForm({\r\n                occupancy: item.occupancy || 'Double',\r\n                category: item.category || '',\r\n                price: item.price || '',\r\n                availableCount: item.availableCount || 0,\r\n                totalInventory: item.totalInventory || 1,\r\n                otherInfo: item.otherInfo || '',\r\n                amenities: item.amenities || { ac: false, attachedBathroom: false }\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleEditSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setIsSaving(true);\r\n        try {\r\n            if (editingItem.type === 'mess') {\r\n                let posterUrl = editForm.posterUrl;\r\n                if (editImageFiles.length > 0) {\r\n                    const file = editImageFiles[0];\r\n                    const storageRef = ref(storage, `posters/${Date.now()}_${file.name}`);\r\n                    const snapshot = await uploadBytes(storageRef, file);\r\n                    posterUrl = await getDownloadURL(snapshot.ref);\r\n                }\r\n                await updateDoc(doc(db, \"messes\", editingItem.id), {\r\n                    ...editForm,\r\n                    posterUrl,\r\n                    lastUpdatedDate: editForm.isUserSourced ? editForm.lastUpdatedDate : null\r\n                });\r\n            } else {\r\n                await updateDoc(doc(db, \"rooms\", editingItem.id), editForm);\r\n            }\r\n            setEditingItem(null);\r\n            setEditForm(null);\r\n            setEditImageFiles([]);\r\n            alert(\"Updated successfully\");\r\n        } catch (error) {\r\n            console.error(\"Save failed:\", error);\r\n            alert(\"Save failed\");\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleCreatePartner = async (e) => {\r\n        e.preventDefault();\r\n        setPartnerStatus({ type: 'info', msg: 'Creating partner account...' });\r\n\r\n        try {\r\n            // Use secondaryAuth to avoid logging out the operator\r\n            await createUserWithEmailAndPassword(secondaryAuth, partnerEmail, partnerPassword);\r\n\r\n            setPartnerStatus({ type: 'success', msg: `Partner ${partnerEmail} created successfully!` });\r\n            setPartnerEmail('');\r\n            setPartnerPassword('');\r\n\r\n            // secondaryAuth keeps the new user logged in on that instance, which is fine.\r\n            // It does NOT affect the main 'auth' instance used by the dashboard.\r\n\r\n        } catch (error) {\r\n            console.error(\"Partner creation failed:\", error);\r\n            setPartnerStatus({ type: 'error', msg: error.message });\r\n        }\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        await signOut(auth);\r\n        navigate('/');\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-900 text-slate-100\">\r\n            {/* Top Bar */}\r\n            <header className=\"bg-slate-800 border-b border-slate-700 p-4 sticky top-0 z-10 flex justify-between items-center shadow-md\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"bg-emerald-500/10 p-2 rounded-lg text-emerald-500\">\r\n                        <Server size={24} />\r\n                    </div>\r\n                    <h1 className=\"text-xl font-bold bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent\">\r\n                        Operational Center\r\n                    </h1>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <span className=\"text-sm text-slate-400 hidden md:block\">\r\n                        Operator: {auth.currentUser?.email}\r\n                    </span>\r\n                    <button\r\n                        onClick={handleLogout}\r\n                        className=\"flex items-center gap-2 bg-red-500/10 hover:bg-red-500/20 text-red-500 px-4 py-2 rounded-lg transition-colors border border-red-500/20\"\r\n                    >\r\n                        <LogOut size={18} />\r\n                        Logout\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex flex-col md:flex-row min-h-[calc(100vh-73px)]\">\r\n                {/* Sidebar Navigation */}\r\n                <aside className=\"w-full md:w-64 bg-slate-800/50 border-r border-slate-700 p-4 space-y-2\">\r\n                    <button\r\n                        onClick={() => setActiveTab('bookings')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'bookings'\r\n                            ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Calendar size={20} />\r\n                        Global Bookings\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('partners')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'partners'\r\n                            ? 'bg-blue-500 text-white shadow-lg shadow-blue-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Users size={20} />\r\n                        Create Partner\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('claims')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'claims'\r\n                            ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Briefcase size={20} />\r\n                        Listing Claims\r\n                        {claims.filter(c => c.status === 'pending').length > 0 && (\r\n                            <span className=\"ml-auto bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold\">\r\n                                {claims.filter(c => c.status === 'pending').length}\r\n                            </span>\r\n                        )}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('registrations')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'registrations'\r\n                            ? 'bg-blue-500 text-white shadow-lg shadow-blue-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Building2 size={20} />\r\n                        Mess Registrations\r\n                        {registrations.filter(r => r.status === 'pending').length > 0 && (\r\n                            <span className=\"ml-auto bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold\">\r\n                                {registrations.filter(r => r.status === 'pending').length}\r\n                            </span>\r\n                        )}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setActiveTab('inquiries')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'inquiries'\r\n                            ? 'bg-rose-500 text-white shadow-lg shadow-rose-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Shield size={20} />\r\n                        Unregistered Queries\r\n                        {inquiries.filter(i => i.status === 'pending').length > 0 && (\r\n                            <span className=\"ml-auto bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold\">\r\n                                {inquiries.filter(i => i.status === 'pending').length}\r\n                            </span>\r\n                        )}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setActiveTab('room_inquiries')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'room_inquiries'\r\n                            ? 'bg-orange-500 text-white shadow-lg shadow-orange-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <BedDouble size={20} />\r\n                        Room Inquiries\r\n                        {roomInquiries.length > 0 && (\r\n                            <span className=\"ml-auto bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold\">\r\n                                {roomInquiries.length}\r\n                            </span>\r\n                        )}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setActiveTab('feedbacks')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'feedbacks'\r\n                            ? 'bg-purple-500 text-white shadow-lg shadow-purple-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <MessageSquare size={20} />\r\n                        User Feedbacks\r\n                        {feedbacks.filter(f => f.status === 'pending').length > 0 && (\r\n                            <span className=\"ml-auto bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold\">\r\n                                {feedbacks.filter(f => f.status === 'pending').length}\r\n                            </span>\r\n                        )}\r\n                    </button>\r\n\r\n                    <div className=\"pt-4 pb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest px-4\">\r\n                        Data Management\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={() => setActiveTab('messes')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'messes'\r\n                            ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Database size={20} />\r\n                        All Messes\r\n                        <span className=\"ml-auto bg-white/10 px-2 py-0.5 rounded text-[10px] font-bold opacity-60\">\r\n                            {messes.length}\r\n                        </span>\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setActiveTab('rooms')}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'rooms'\r\n                            ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20'\r\n                            : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'\r\n                            }`}\r\n                    >\r\n                        <Layout size={20} />\r\n                        All Rooms\r\n                        <span className=\"ml-auto bg-white/10 px-2 py-0.5 rounded text-[10px] font-bold opacity-60\">\r\n                            {rooms.length}\r\n                        </span>\r\n                    </button>\r\n                </aside>\r\n\r\n                {/* Main Content */}\r\n                <main className=\"flex-1 p-4 md:p-8 overflow-y-auto\">\r\n\r\n                    {/* BOOKINGS TAB */}\r\n                    {activeTab === 'bookings' && (\r\n                        <div className=\"max-w-5xl mx-auto\">\r\n                            <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2\">\r\n                                <Calendar className=\"text-emerald-500\" />\r\n                                All System Bookings\r\n                            </h2>\r\n                            <div className=\"space-y-4\">\r\n                                {bookings.length === 0 ? (\r\n                                    <div className=\"text-center py-20 text-slate-500 bg-slate-800/50 rounded-2xl border border-slate-700 border-dashed\">\r\n                                        No bookings found in the system.\r\n                                    </div>\r\n                                ) : (\r\n                                    bookings.map(booking => (\r\n                                        <div key={booking.id} className=\"bg-slate-800 rounded-xl p-5 border border-slate-700 shadow-sm flex flex-col md:flex-row justify-between gap-4\">\r\n                                            <div className=\"flex-1 space-y-1\">\r\n                                                <div className=\"flex items-center gap-3 mb-2\">\r\n                                                    <span className={`px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide ${booking.status === 'confirmed' ? 'bg-green-500/20 text-green-400 border border-green-500/30' :\r\n                                                        booking.status === 'rejected' ? 'bg-red-500/20 text-red-400 border border-red-500/30' :\r\n                                                            'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'\r\n                                                        }`}>\r\n                                                        {booking.status}\r\n                                                    </span>\r\n                                                    <span className=\"text-slate-500 text-xs\">ID: {booking.id.slice(0, 8)}</span>\r\n                                                </div>\r\n                                                <h3 className=\"font-bold text-white text-lg\">{booking.messName}</h3>\r\n                                                <p className=\"text-slate-400 text-sm\">{booking.roomType} Room â€¢ â‚¹{booking.price}/mo</p>\r\n                                                <div className=\"pt-2 flex items-center gap-4 text-sm\">\r\n                                                    <div className=\"flex items-center gap-1 text-slate-300\">\r\n                                                        <Users size={14} /> {booking.userName}\r\n                                                    </div>\r\n                                                    <div className=\"text-slate-400 flex items-center gap-2\">\r\n                                                        <span className=\"font-mono bg-slate-900 px-2 py-1 rounded\">\r\n                                                            {revealedIds[booking.id] ? booking.userPhone : booking.userPhone?.replace(/\\d(?=\\d{4})/g, \"*\")}\r\n                                                        </span>\r\n                                                        <button\r\n                                                            onClick={() => setRevealedIds(prev => ({ ...prev, [booking.id]: !prev[booking.id] }))}\r\n                                                            className=\"text-slate-500 hover:text-emerald-400 transition-colors\"\r\n                                                            title={revealedIds[booking.id] ? \"Hide Number\" : \"Show Number\"}\r\n                                                        >\r\n                                                            {revealedIds[booking.id] ? <EyeOff size={14} /> : <Eye size={14} />}\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {booking.status !== 'pending' && booking.remark && (\r\n                                                    <div className=\"mt-3 p-3 bg-slate-900/50 rounded-lg border border-slate-700/50 text-xs text-slate-400 italic\">\r\n                                                        Remark: {booking.remark}\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {booking.status === 'pending' ? (\r\n                                                <div className=\"flex flex-col gap-3 min-w-[280px]\">\r\n                                                    <textarea\r\n                                                        placeholder=\"Write a remark (optional)...\"\r\n                                                        value={bookingRemarks[booking.id] || ''}\r\n                                                        onChange={(e) => setBookingRemarks(prev => ({ ...prev, [booking.id]: e.target.value }))}\r\n                                                        className=\"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-sm text-white focus:ring-1 focus:ring-emerald-500 outline-none resize-none h-20\"\r\n                                                    />\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <button\r\n                                                            onClick={() => handleBookingAction(booking.id, 'confirmed')}\r\n                                                            className=\"flex-1 flex items-center justify-center gap-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors shadow-lg shadow-green-900/20 text-sm\"\r\n                                                        >\r\n                                                            <CheckCircle size={16} /> Approve\r\n                                                        </button>\r\n                                                        <button\r\n                                                            onClick={() => handleBookingAction(booking.id, 'rejected')}\r\n                                                            className=\"flex-1 flex items-center justify-center gap-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg font-medium transition-colors border border-slate-600 text-sm\"\r\n                                                        >\r\n                                                            <XCircle size={16} /> Reject\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={async () => {\r\n                                                        if (window.confirm(\"Delete this completed booking record?\")) {\r\n                                                            try {\r\n                                                                await deleteDoc(doc(db, \"bookings\", booking.id));\r\n                                                            } catch (e) { alert(\"Delete failed\"); }\r\n                                                        }\r\n                                                    }}\r\n                                                    className=\"self-end md:self-center flex items-center gap-1 px-4 py-2 bg-slate-700 hover:bg-red-500/20 hover:text-red-400 text-slate-400 rounded-lg text-sm font-medium transition-all border border-slate-600\"\r\n                                                >\r\n                                                    <Trash2 size={16} /> Delete\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* PARTNERS TAB */}\r\n                    {activeTab === 'partners' && (\r\n                        <div className=\"max-w-xl mx-auto mt-10\">\r\n                            <div className=\"bg-slate-800 rounded-2xl border border-slate-700 p-8 shadow-2xl\">\r\n                                <div className=\"flex items-center gap-3 mb-6\">\r\n                                    <div className=\"bg-blue-500/10 p-3 rounded-full text-blue-500\">\r\n                                        <UserPlus size={24} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h2 className=\"text-xl font-bold text-white\">Add New Partner</h2>\r\n                                        <p className=\"text-slate-400 text-sm\">Create credentials for a mess owner</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {partnerStatus.msg && (\r\n                                    <div className={`p-4 rounded-xl mb-6 text-sm border ${partnerStatus.type === 'success' ? 'bg-green-500/10 text-green-400 border-green-500/20' :\r\n                                        partnerStatus.type === 'error' ? 'bg-red-500/10 text-red-400 border-red-500/20' :\r\n                                            'bg-blue-500/10 text-blue-400 border-blue-500/20'\r\n                                        }`}>\r\n                                        {partnerStatus.msg}\r\n                                    </div>\r\n                                )}\r\n\r\n                                <form onSubmit={handleCreatePartner} className=\"space-y-5\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-300 mb-1\">Partner Email</label>\r\n                                        <input\r\n                                            type=\"email\"\r\n                                            required\r\n                                            className=\"w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl text-white focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                            value={partnerEmail}\r\n                                            onChange={(e) => setPartnerEmail(e.target.value)}\r\n                                            placeholder=\"owner@example.com\"\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-300 mb-1\">Temporary Password</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            required\r\n                                            className=\"w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl text-white focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                            value={partnerPassword}\r\n                                            onChange={(e) => setPartnerPassword(e.target.value)}\r\n                                            placeholder=\"SecurePassword123\"\r\n                                        />\r\n                                        <p className=\"text-xs text-slate-500 mt-2\">\r\n                                            <Shield size={12} className=\"inline mr-1\" />\r\n                                            Admin account will be created directly in Auth.\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        className=\"w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-blue-600/20 active:scale-95\"\r\n                                    >\r\n                                        Create Account\r\n                                    </button>\r\n                                </form>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* NEW ROOM INQUIRIES TAB */}\r\n                    {activeTab === 'room_inquiries' && (\r\n                        <div className=\"max-w-6xl mx-auto\">\r\n                            <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2 text-orange-500\">\r\n                                <BedDouble />\r\n                                Book Room Requests\r\n                            </h2>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                {roomInquiries.length === 0 ? (\r\n                                    <div className=\"col-span-full text-center py-20 text-slate-500 bg-slate-800/50 rounded-2xl border border-slate-700 border-dashed\">\r\n                                        No room inquiries found.\r\n                                    </div>\r\n                                ) : (\r\n                                    roomInquiries.map(inquiry => (\r\n                                        <div key={inquiry.id} className=\"bg-slate-800 rounded-xl p-5 border border-slate-700 shadow-sm relative group\">\r\n                                            <button\r\n                                                onClick={async () => {\r\n                                                    if (window.confirm(\"Delete this inquiry?\")) {\r\n                                                        try {\r\n                                                            await deleteDoc(doc(db, \"room_inquiries\", inquiry.id));\r\n                                                        } catch (e) { alert(\"Delete failed\"); }\r\n                                                    }\r\n                                                }}\r\n                                                className=\"absolute top-4 right-4 p-2 text-slate-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors opacity-0 group-hover:opacity-100\"\r\n                                            >\r\n                                                <Trash2 size={16} />\r\n                                            </button>\r\n\r\n                                            <div className=\"mb-4\">\r\n                                                <h3 className=\"text-lg font-bold text-white mb-1\">{inquiry.name}</h3>\r\n                                                <div className=\"flex items-center gap-2 text-sm text-slate-400\">\r\n                                                    <Phone size={14} className=\"text-orange-500\" />\r\n                                                    {inquiry.phone}\r\n                                                    {inquiry.contactMethod && (\r\n                                                        <span className={`text-[10px] px-1.5 py-0.5 rounded border ${inquiry.contactMethod === 'whatsapp' ? 'bg-green-500/10 text-green-500 border-green-500/20' : 'bg-blue-500/10 text-blue-500 border-blue-500/20'}`}>\r\n                                                            {inquiry.contactMethod.toUpperCase()}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"space-y-3 bg-slate-900/50 p-4 rounded-lg border border-slate-700/50 text-sm\">\r\n                                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                                    <div>\r\n                                                        <p className=\"text-[10px] uppercase font-bold text-slate-500\">Location</p>\r\n                                                        <p className=\"text-slate-200\">{inquiry.location}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"text-[10px] uppercase font-bold text-slate-500\">Budget</p>\r\n                                                        <p className=\"text-emerald-400 font-medium\">{inquiry.budget}</p>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"text-[10px] uppercase font-bold text-slate-500\">Occupancy</p>\r\n                                                    <p className=\"text-slate-200 capitalize\">{inquiry.occupancy}</p>\r\n                                                </div>\r\n                                                {inquiry.requirements && (\r\n                                                    <div>\r\n                                                        <p className=\"text-[10px] uppercase font-bold text-slate-500\">Requirements</p>\r\n                                                        <p className=\"text-slate-400 italic\">\"{inquiry.requirements}\"</p>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            <div className=\"mt-4 pt-3 border-t border-slate-700 text-[10px] text-slate-500 flex justify-between\">\r\n                                                <span>Submitted: {inquiry.createdAt?.seconds ? new Date(inquiry.createdAt.seconds * 1000).toLocaleString() : 'Just now'}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* CLAIMS TAB */}\r\n                    {activeTab === 'claims' && (\r\n                        <div className=\"max-w-5xl mx-auto\">\r\n                            <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2 text-amber-500\">\r\n                                <Briefcase />\r\n                                Listing Claim Requests\r\n                            </h2>\r\n                            <div className=\"space-y-4\">\r\n                                {claims.length === 0 ? (\r\n                                    <div className=\"text-center py-20 text-slate-500 bg-slate-800/50 rounded-2xl border border-slate-700 border-dashed\">\r\n                                        No claim requests found.\r\n                                    </div>\r\n                                ) : (\r\n                                    claims.map(claim => (\r\n                                        <div key={claim.id} className=\"bg-slate-800 rounded-xl p-5 border border-slate-700 shadow-sm\">\r\n                                            <div className=\"flex flex-col md:flex-row justify-between gap-4\">\r\n                                                <div className=\"space-y-2\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${claim.status === 'resolved' ? 'bg-green-500/20 text-green-400' : 'bg-amber-500/20 text-amber-400'}`}>\r\n                                                            {claim.status}\r\n                                                        </span>\r\n                                                        <span className=\"text-slate-500 text-xs\">Claim ID: {claim.id.slice(0, 8)}</span>\r\n                                                    </div>\r\n                                                    <h3 className=\"font-bold text-white text-xl flex items-center gap-2\">\r\n                                                        {claim.messName}\r\n                                                        <span className=\"text-xs font-normal text-slate-400\">(ID: {claim.messId?.slice(0, 6)}...)</span>\r\n                                                    </h3>\r\n\r\n                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 mt-4 bg-slate-900/50 p-4 rounded-lg border border-slate-700/50\">\r\n                                                        <div>\r\n                                                            <p className=\"text-[10px] text-slate-500 uppercase font-bold mb-1\">Claimant Name</p>\r\n                                                            <p className=\"text-slate-200 font-medium\">{claim.userName}</p>\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <p className=\"text-[10px] text-slate-500 uppercase font-bold mb-1\">Email Address</p>\r\n                                                            <p className=\"text-slate-200 font-medium\">{claim.userEmail}</p>\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <p className=\"text-[10px] text-slate-500 uppercase font-bold mb-1\">Phone Number</p>\r\n                                                            <p className=\"text-slate-200 font-medium\">{claim.userPhone}</p>\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <p className=\"text-[10px] text-slate-500 uppercase font-bold mb-1\">Request Date</p>\r\n\r\n                                                            <p className=\"text-slate-200 font-medium\">\r\n                                                                {claim.createdAt?.seconds ? new Date(claim.createdAt.seconds * 1000).toLocaleString() : 'N/A'}\r\n                                                            </p>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <div className=\"flex flex-row md:flex-col gap-2 self-start md:justify-center\">\r\n                                                    {claim.status === 'pending' ? (\r\n                                                        <button\r\n                                                            onClick={async () => {\r\n                                                                try {\r\n                                                                    await updateDoc(doc(db, \"claims\", claim.id), { status: 'resolved' });\r\n                                                                } catch (e) { alert(\"Update failed\"); }\r\n                                                            }}\r\n                                                            className=\"flex items-center gap-1 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg text-sm font-bold transition-all shadow-lg shadow-emerald-900/20\"\r\n                                                        >\r\n                                                            <ClipboardCheck size={16} /> Mark Resolved\r\n                                                        </button>\r\n                                                    ) : (\r\n                                                        <>\r\n                                                            <span className=\"text-emerald-500 text-sm font-bold flex items-center gap-1 bg-emerald-500/10 px-3 py-2 rounded-lg\">\r\n                                                                <CheckCircle size={16} /> Resolved\r\n                                                            </span>\r\n                                                            <button\r\n                                                                onClick={async () => {\r\n                                                                    if (window.confirm(\"Delete this resolved claim record?\")) {\r\n                                                                        try {\r\n                                                                            await deleteDoc(doc(db, \"claims\", claim.id));\r\n                                                                        } catch (e) { alert(\"Delete failed\"); }\r\n                                                                    }\r\n                                                                }}\r\n                                                                className=\"flex items-center gap-1 px-4 py-2 bg-slate-700 hover:bg-red-500/20 hover:text-red-400 text-slate-400 rounded-lg text-sm font-medium transition-all border border-slate-600\"\r\n                                                            >\r\n                                                                <Trash2 size={16} /> Delete\r\n                                                            </button>\r\n                                                        </>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Mess Registrations Tab */}\r\n                    {activeTab === 'registrations' && (\r\n                        <div className=\"space-y-6\">\r\n                            <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2 text-blue-500\">\r\n                                <Building2 />\r\n                                New Mess Registrations\r\n                            </h2>\r\n                            <div className=\"grid gap-6 grid-cols-1 xl:grid-cols-2\">\r\n                                {registrations.map(reg => (\r\n                                    <div key={reg.id} className=\"bg-slate-800 rounded-xl p-5 border border-slate-700 shadow-sm\">\r\n                                        <div className=\"flex justify-between items-start mb-4\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"p-3 bg-blue-500/10 rounded-lg\">\r\n                                                    <Building2 className=\"text-blue-500\" size={24} />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <h3 className=\"font-bold text-white text-lg\">{reg.messName}</h3>\r\n                                                    <div className=\"flex items-center gap-2 mt-1\">\r\n                                                        <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${reg.status === 'pending' ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30' : 'bg-green-500/20 text-green-400 border border-green-500/30'}`}>\r\n                                                            {reg.status}\r\n                                                        </span>\r\n                                                        <span className=\"text-slate-500 text-xs flex items-center gap-1\">\r\n                                                            <Calendar size={12} />\r\n                                                            {reg.createdAt?.seconds ? new Date(reg.createdAt.seconds * 1000).toLocaleDateString() : 'Recently'}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={async () => {\r\n                                                    if (window.confirm(\"Delete this registration?\")) {\r\n                                                        try {\r\n                                                            await deleteDoc(doc(db, \"mess_registrations\", reg.id));\r\n                                                        } catch (e) { alert(\"Delete failed\"); }\r\n                                                    }\r\n                                                }}\r\n                                                className=\"p-2 hover:bg-red-500/20 hover:text-red-400 text-slate-400 rounded-lg transition-colors border border-transparent hover:border-red-500/30\"\r\n                                            >\r\n                                                <Trash2 size={18} />\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-3 bg-slate-900/50 rounded-xl p-4 border border-slate-700/50\">\r\n                                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                                <div>\r\n                                                    <p className=\"text-slate-500 text-xs uppercase font-bold mb-1\">Mess Type</p>\r\n                                                    <div className=\"flex flex-wrap gap-1\">\r\n                                                        {reg.messType?.map((t, i) => (\r\n                                                            <span key={i} className=\"px-2 py-1 bg-slate-800 rounded text-xs text-white border border-slate-700\">\r\n                                                                {t}\r\n                                                            </span>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"text-slate-500 text-xs uppercase font-bold mb-1\">Phone</p>\r\n                                                    <a href={`tel:${reg.phoneNumber}`} className=\"text-blue-400 hover:underline flex items-center gap-1 font-mono text-sm\">\r\n                                                        <Phone size={14} /> {reg.phoneNumber}\r\n                                                    </a>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div>\r\n                                                <p className=\"text-slate-500 text-xs uppercase font-bold mb-1\">Landmark</p>\r\n                                                <div className=\"flex items-start gap-1 text-slate-300 text-sm\">\r\n                                                    <MapPin size={14} className=\"mt-0.5 shrink-0 text-slate-500\" />\r\n                                                    {reg.landmark}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div>\r\n                                                <p className=\"text-slate-500 text-xs uppercase font-bold mb-1\">Room Types</p>\r\n                                                <div className=\"flex flex-wrap gap-1\">\r\n                                                    {reg.roomTypes?.map((t, i) => (\r\n                                                        <span key={i} className=\"px-2 py-1 bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded text-xs\">\r\n                                                            {t}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div>\r\n                                                <p className=\"text-slate-500 text-xs uppercase font-bold mb-1\">Facilities</p>\r\n                                                <div className=\"flex flex-wrap gap-1\">\r\n                                                    {reg.facilities?.map((f, i) => (\r\n                                                        <span key={i} className=\"px-2 py-1 bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 rounded text-xs\">\r\n                                                            {f}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {registrations.length === 0 && (\r\n                                    <div className=\"col-span-full flex flex-col items-center justify-center py-20 text-slate-500 border-2 border-dashed border-slate-700 rounded-xl\">\r\n                                        <Building2 size={48} className=\"mb-4 opacity-50\" />\r\n                                        <p className=\"text-lg font-medium\">No mess registrations yet</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* INQUIRIES TAB */}\r\n\r\n                    {activeTab === 'inquiries' && (\r\n                        <div className=\"max-w-5xl mx-auto\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h2 className=\"text-2xl font-bold flex items-center gap-2 text-rose-500\">\r\n                                    <Shield />\r\n                                    Unregistered Queries\r\n                                </h2>\r\n                                <span className=\"bg-rose-500/10 text-rose-500 px-3 py-1 rounded-full text-sm font-bold border border-rose-500/20\">\r\n                                    {inquiries.length} Total\r\n                                </span>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                {inquiries.length === 0 ? (\r\n                                    <div className=\"col-span-full text-center py-20 text-slate-500 bg-slate-800/50 rounded-2xl border border-slate-700 border-dashed\">\r\n                                        No unregistered queries found.\r\n                                    </div>\r\n                                ) : (\r\n                                    inquiries.map(inquiry => (\r\n                                        <div key={inquiry.id} className=\"bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl flex flex-col h-full\">\r\n                                            <div className=\"flex justify-between items-start mb-4\">\r\n                                                <div className={`px-2 py-1 rounded text-[10px] font-black uppercase tracking-widest ${inquiry.status === 'resolved' ? 'bg-green-500/20 text-green-400' : 'bg-rose-500/20 text-rose-400'}`}>\r\n                                                    {inquiry.status}\r\n                                                </div>\r\n                                                <span className=\"text-slate-500 text-[10px] font-mono tracking-tighter\">#{inquiry.id.slice(-6)}</span>\r\n                                            </div>\r\n\r\n                                            <div className=\"mb-4\">\r\n                                                <h3 className=\"text-lg font-bold text-white mb-1\">{inquiry.name}</h3>\r\n                                                <p className=\"text-slate-400 text-sm flex items-center gap-2\">\r\n                                                    <Phone size={14} className=\"text-emerald-500\" />\r\n                                                    {inquiry.phone}\r\n                                                </p>\r\n                                            </div>\r\n\r\n                                            <div className=\"bg-slate-900/50 rounded-xl p-4 mb-6 border border-slate-700/50 flex-grow\">\r\n                                                <div className=\"flex flex-col gap-3\">\r\n                                                    <div>\r\n                                                        <p className=\"text-[10px] text-slate-500 uppercase font-black mb-1\">Target Mess</p>\r\n                                                        <p className=\"text-slate-200 text-sm font-medium\">{inquiry.messName}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"text-[10px] text-slate-500 uppercase font-black mb-1\">Looking For</p>\r\n                                                        <p className=\"text-emerald-400 text-sm font-bold\">{inquiry.seating}</p>\r\n                                                    </div>\r\n                                                    <div className=\"pt-2 border-t border-slate-700/50\">\r\n                                                        <p className=\"text-[10px] text-slate-500 uppercase font-black mb-1\">Requested On</p>\r\n                                                        <p className=\"text-slate-400 text-[11px]\">\r\n                                                            {inquiry.createdAt?.seconds ? new Date(inquiry.createdAt.seconds * 1000).toLocaleString() : 'Recently'}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"grid grid-cols-2 gap-3 mt-auto\">\r\n                                                {inquiry.status === 'pending' ? (\r\n                                                    <button\r\n                                                        onClick={async () => {\r\n                                                            try {\r\n                                                                await updateDoc(doc(db, \"inquiries\", inquiry.id), { status: 'resolved' });\r\n                                                            } catch (e) { alert(\"Failed to resolve\"); }\r\n                                                        }}\r\n                                                        className=\"col-span-2 flex items-center justify-center gap-2 bg-emerald-500 hover:bg-emerald-600 text-white py-2.5 rounded-xl text-xs font-bold transition-all shadow-lg shadow-emerald-900/20\"\r\n                                                    >\r\n                                                        <CheckCircle size={14} /> Resolve\r\n                                                    </button>\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <div className=\"flex items-center justify-center gap-2 bg-emerald-500/10 text-emerald-500 py-2.5 rounded-xl text-xs font-bold border border-emerald-500/20\">\r\n                                                            <CheckCircle size={14} /> Done\r\n                                                        </div>\r\n                                                        <button\r\n                                                            onClick={async () => {\r\n                                                                if (window.confirm(\"Delete this solved query?\")) {\r\n                                                                    try {\r\n                                                                        await deleteDoc(doc(db, \"inquiries\", inquiry.id));\r\n                                                                    } catch (e) { alert(\"Delete failed\"); }\r\n                                                                }\r\n                                                            }}\r\n                                                            className=\"flex items-center justify-center gap-2 bg-slate-700 hover:bg-red-500/20 hover:text-red-400 text-slate-400 py-2.5 rounded-xl text-xs font-bold transition-all border border-slate-600\"\r\n                                                        >\r\n                                                            <Trash2 size={14} /> Delete\r\n                                                        </button>\r\n                                                    </>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* FEEDBACKS TAB */}\r\n                    {activeTab === 'feedbacks' && (\r\n                        <div className=\"max-w-5xl mx-auto\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h2 className=\"text-2xl font-bold flex items-center gap-2 text-purple-500\">\r\n                                    <MessageSquare />\r\n                                    User Feedbacks\r\n                                </h2>\r\n                                <span className=\"bg-purple-500/10 text-purple-500 px-3 py-1 rounded-full text-sm font-bold border border-purple-500/20\">\r\n                                    {feedbacks.length} Total\r\n                                </span>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                {feedbacks.length === 0 ? (\r\n                                    <div className=\"text-center py-20 text-slate-500 bg-slate-800/50 rounded-2xl border border-slate-700 border-dashed\">\r\n                                        No feedbacks submitted yet.\r\n                                    </div>\r\n                                ) : (\r\n                                    feedbacks.map(feedback => (\r\n                                        <div key={feedback.id} className=\"bg-slate-800 rounded-xl p-5 border border-slate-700 shadow-sm\">\r\n                                            <div className=\"flex flex-col gap-4\">\r\n                                                {/* Header */}\r\n                                                <div className=\"flex justify-between items-start\">\r\n                                                    <div className=\"space-y-2\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${feedback.status === 'replied' ? 'bg-green-500/20 text-green-400 border border-green-500/30' :\r\n                                                                feedback.status === 'resolved' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :\r\n                                                                    'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'\r\n                                                                }`}>\r\n                                                                {feedback.status}\r\n                                                            </span>\r\n                                                            <span className=\"text-slate-500 text-xs\">ID: {feedback.id.slice(0, 8)}</span>\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <h3 className=\"font-bold text-white text-base\">{feedback.userName}</h3>\r\n                                                            {feedback.userEmail && (\r\n                                                                <p className=\"text-slate-400 text-sm\">{feedback.userEmail}</p>\r\n                                                            )}\r\n                                                            <p className=\"text-slate-500 text-xs mt-1\">\r\n                                                                {feedback.createdAt?.seconds ? new Date(feedback.createdAt.seconds * 1000).toLocaleString() : 'Recently'}\r\n                                                            </p>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    {/* Delete Button */}\r\n                                                    <button\r\n                                                        onClick={async () => {\r\n                                                            if (window.confirm(\"Delete this feedback?\")) {\r\n                                                                try {\r\n                                                                    await deleteDoc(doc(db, \"feedbacks\", feedback.id));\r\n                                                                } catch (e) { alert(\"Delete failed\"); }\r\n                                                            }\r\n                                                        }}\r\n                                                        className=\"flex items-center gap-1 px-3 py-2 bg-slate-700 hover:bg-red-500/20 hover:text-red-400 text-slate-400 rounded-lg text-sm font-medium transition-all border border-slate-600\"\r\n                                                    >\r\n                                                        <Trash2 size={16} /> Delete\r\n                                                    </button>\r\n                                                </div>\r\n\r\n                                                {/* Feedback Message */}\r\n                                                <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-700/50\">\r\n                                                    <p className=\"text-sm font-bold text-slate-400 uppercase mb-2\">Feedback Message</p>\r\n                                                    <p className=\"text-white text-sm leading-relaxed\">{feedback.message}</p>\r\n                                                </div>\r\n\r\n                                                {/* Operator Reply Display */}\r\n                                                {feedback.operatorReply && (\r\n                                                    <div className=\"p-4 bg-emerald-900/10 rounded-xl border border-emerald-500/20\">\r\n                                                        <div className=\"flex items-center gap-2 mb-2\">\r\n                                                            <Reply size={14} className=\"text-emerald-500\" />\r\n                                                            <p className=\"text-xs font-bold text-emerald-500 uppercase\">Your Reply</p>\r\n                                                        </div>\r\n                                                        <p className=\"text-slate-300 text-sm leading-relaxed\">{feedback.operatorReply}</p>\r\n                                                        {feedback.repliedAt?.seconds && (\r\n                                                            <p className=\"text-slate-500 text-xs mt-2\">\r\n                                                                Replied: {new Date(feedback.repliedAt.seconds * 1000).toLocaleString()}\r\n                                                            </p>\r\n                                                        )}\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {/* Reply Form */}\r\n                                                {!feedback.operatorReply && (\r\n                                                    <div className=\"space-y-3\">\r\n                                                        <textarea\r\n                                                            placeholder=\"Write your reply to this feedback...\"\r\n                                                            value={feedbackReplies[feedback.id] || ''}\r\n                                                            onChange={(e) => setFeedbackReplies(prev => ({ ...prev, [feedback.id]: e.target.value }))}\r\n                                                            className=\"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-sm text-white focus:ring-2 focus:ring-purple-500 outline-none resize-none h-24\"\r\n                                                        />\r\n                                                        <button\r\n                                                            onClick={async () => {\r\n                                                                const reply = feedbackReplies[feedback.id];\r\n                                                                if (!reply?.trim()) {\r\n                                                                    alert(\"Please enter a reply\");\r\n                                                                    return;\r\n                                                                }\r\n                                                                try {\r\n                                                                    await updateDoc(doc(db, \"feedbacks\", feedback.id), {\r\n                                                                        operatorReply: reply.trim(),\r\n                                                                        repliedAt: serverTimestamp(),\r\n                                                                        repliedBy: auth.currentUser?.email,\r\n                                                                        status: 'replied'\r\n                                                                    });\r\n                                                                    setFeedbackReplies(prev => {\r\n                                                                        const updated = { ...prev };\r\n                                                                        delete updated[feedback.id];\r\n                                                                        return updated;\r\n                                                                    });\r\n                                                                } catch (error) {\r\n                                                                    console.error(\"Reply failed:\", error);\r\n                                                                    alert(\"Failed to send reply\");\r\n                                                                }\r\n                                                            }}\r\n                                                            className=\"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors shadow-lg shadow-purple-900/20 text-sm\"\r\n                                                        >\r\n                                                            <Reply size={16} /> Send Reply\r\n                                                        </button>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* ALL MESSES MANAGEMENT */}\r\n                    {activeTab === 'messes' && (\r\n                        <div className=\"max-w-6xl mx-auto\">\r\n                            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4\">\r\n                                <h2 className=\"text-2xl font-bold flex items-center gap-3 text-indigo-400\">\r\n                                    <Database size={28} />\r\n                                    Mess Directory\r\n                                </h2>\r\n                                <div className=\"relative w-full md:w-96\">\r\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500\" size={18} />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Search by name or address...\"\r\n                                        className=\"w-full pl-10 pr-4 py-2 bg-slate-800 border border-slate-700 rounded-xl text-white focus:ring-2 focus:ring-indigo-500 outline-none shadow-inner\"\r\n                                        value={searchQuery}\r\n                                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 gap-4\">\r\n                                {messes.filter(m =>\r\n                                    m.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                                    m.address.toLowerCase().includes(searchQuery.toLowerCase())\r\n                                ).map(mess => (\r\n                                    <div key={mess.id} className=\"bg-slate-800 border border-slate-700 rounded-2xl p-4 md:p-6 flex flex-col md:flex-row justify-between items-center gap-6 group hover:border-indigo-500/50 transition-all shadow-lg hover:shadow-indigo-500/5\">\r\n                                        <div className=\"flex items-center gap-5 w-full md:w-auto\">\r\n                                            <div className=\"relative\">\r\n                                                <div className=\"w-16 h-16 rounded-2xl bg-slate-700/50 flex items-center justify-center text-indigo-400 overflow-hidden border border-slate-600\">\r\n                                                    {mess.posterUrl ? (\r\n                                                        <img src={mess.posterUrl} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                                                    ) : (\r\n                                                        <Server size={24} />\r\n                                                    )}\r\n                                                </div>\r\n                                                {mess.hidden && (\r\n                                                    <div className=\"absolute -top-2 -right-2 bg-rose-500 text-white p-1 rounded-full shadow-lg border border-rose-600\">\r\n                                                        <EyeOff size={10} />\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                            <div>\r\n                                                <h3 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                                                    {mess.name}\r\n                                                    {mess.isUserSourced && (\r\n                                                        <span className=\"text-[10px] bg-amber-500/10 text-amber-500 px-1.5 py-0.5 rounded border border-amber-500/20 uppercase font-black\">\r\n                                                            Sourced\r\n                                                        </span>\r\n                                                    )}\r\n                                                </h3>\r\n                                                <p className=\"text-slate-400 text-sm line-clamp-1 flex items-center gap-1.5\">\r\n                                                    <MapPin size={12} className=\"opacity-50\" /> {mess.address}\r\n                                                </p>\r\n                                                <p className=\"text-slate-500 text-[11px] mt-1 font-mono\">{mess.id}</p>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex items-center gap-3 w-full md:w-auto justify-end\">\r\n                                            <button\r\n                                                onClick={() => handleToggleVisibility(mess.id, mess.hidden)}\r\n                                                className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all border ${mess.hidden\r\n                                                    ? 'bg-rose-500/10 text-rose-500 border-rose-500/20 hover:bg-rose-500/20'\r\n                                                    : 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20 hover:bg-emerald-500/20'\r\n                                                    }`}\r\n                                                title={mess.hidden ? \"Show Listing\" : \"Hide Listing\"}\r\n                                            >\r\n                                                {mess.hidden ? <EyeOff size={16} /> : <Eye size={16} />}\r\n                                                {mess.hidden ? 'Private' : 'Public'}\r\n                                            </button>\r\n\r\n                                            <button\r\n                                                onClick={() => handleEditItem(mess, 'mess')}\r\n                                                className=\"p-2.5 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-xl transition-all border border-slate-600\"\r\n                                            >\r\n                                                <Edit3 size={18} />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* ALL ROOMS MANAGEMENT */}\r\n                    {activeTab === 'rooms' && (\r\n                        <div className=\"max-w-6xl mx-auto\">\r\n                            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4\">\r\n                                <h2 className=\"text-2xl font-bold flex items-center gap-3 text-cyan-400\">\r\n                                    <Layout size={28} />\r\n                                    Global Room Inventory\r\n                                </h2>\r\n                                <div className=\"relative w-full md:w-96\">\r\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500\" size={18} />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Search by mess name or category...\"\r\n                                        className=\"w-full pl-10 pr-4 py-2 bg-slate-800 border border-slate-700 rounded-xl text-white focus:ring-2 focus:ring-cyan-500 outline-none shadow-inner\"\r\n                                        value={searchQuery}\r\n                                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                {rooms.filter(r =>\r\n                                    (r.messName || \"\").toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                                    (r.category || \"\").toLowerCase().includes(searchQuery.toLowerCase())\r\n                                ).map(room => (\r\n                                    <div key={room.id} className=\"bg-slate-800 border border-slate-700 rounded-2xl p-5 flex flex-col hover:border-cyan-500/50 transition-all shadow-xl group\">\r\n                                        <div className=\"flex justify-between items-start mb-4\">\r\n                                            <div className=\"bg-cyan-500/10 text-cyan-500 px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider border border-cyan-500/20\">\r\n                                                {room.occupancy} Room\r\n                                            </div>\r\n                                            <span className=\"text-slate-500 text-[10px] font-mono\">#{room.id.slice(-6)}</span>\r\n                                        </div>\r\n\r\n                                        <h3 className=\"text-lg font-bold text-white mb-1 group-hover:text-cyan-400 transition-colors\">\r\n                                            {room.messName}\r\n                                        </h3>\r\n                                        <p className=\"text-slate-400 text-xs mb-4 flex items-center gap-1.5 min-h-[16px]\">\r\n                                            {room.category && <><Layout size={12} className=\"opacity-50\" /> {room.category}</>}\r\n                                        </p>\r\n\r\n                                        <div className=\"bg-slate-900/50 rounded-xl p-4 mb-5 border border-slate-700/50 flex-grow\">\r\n                                            <div className=\"flex justify-between items-center mb-2\">\r\n                                                <span className=\"text-xs text-slate-500 uppercase font-black\">Price</span>\r\n                                                <span className=\"text-emerald-400 font-bold\">â‚¹{room.price}/mo</span>\r\n                                            </div>\r\n                                            <div className=\"flex justify-between items-center\">\r\n                                                <span className=\"text-xs text-slate-500 uppercase font-black\">Availability</span>\r\n                                                <span className=\"text-white font-bold\">{room.availableCount} {room.occupancy === 'Single' ? 'Bed' : 'Seats'}</span>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex gap-2 mt-auto\">\r\n                                            <button\r\n                                                onClick={() => handleEditItem(room, 'room')}\r\n                                                className=\"flex-1 flex items-center justify-center gap-2 bg-slate-700 hover:bg-slate-600 text-slate-200 py-2.5 rounded-xl text-xs font-bold transition-all border border-slate-600\"\r\n                                            >\r\n                                                <Edit3 size={14} /> Edit\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </main>\r\n            </div>\r\n\r\n            {/* EDIT MODAL */}\r\n            {editingItem && editForm && (\r\n                <div className=\"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n                    <div className=\"bg-slate-800 w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl shadow-2xl border border-slate-700 animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"sticky top-0 bg-slate-800 p-6 border-b border-slate-700 flex justify-between items-center z-10\">\r\n                            <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n                                <Edit3 size={20} className=\"text-indigo-400\" />\r\n                                Edit {editingItem.type === 'mess' ? 'Mess Profile' : 'Room Type'}\r\n                            </h2>\r\n                            <button\r\n                                onClick={() => { setEditingItem(null); setEditForm(null); }}\r\n                                className=\"p-2 hover:bg-slate-700 rounded-full transition-colors\"\r\n                            >\r\n                                <XCircle size={24} className=\"text-slate-400\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <form onSubmit={handleEditSubmit} className=\"p-6 space-y-6\">\r\n                            {editingItem.type === 'mess' ? (\r\n                                <>\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Mess Name</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                                value={editForm.name}\r\n                                                onChange={e => setEditForm({ ...editForm, name: e.target.value })}\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Type</label>\r\n                                            <select\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                                value={editForm.messType}\r\n                                                onChange={e => setEditForm({ ...editForm, messType: e.target.value })}\r\n                                            >\r\n                                                <option value=\"Boys\">Boys Mess</option>\r\n                                                <option value=\"Girls\">Girls Mess</option>\r\n                                                <option value=\"Co-ed\">Co-ed Mess</option>\r\n                                            </select>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Address</label>\r\n                                        <textarea\r\n                                            className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500 h-20 resize-none\"\r\n                                            value={editForm.address}\r\n                                            onChange={e => setEditForm({ ...editForm, address: e.target.value })}\r\n                                            required\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Contact</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                                value={editForm.contact}\r\n                                                onChange={e => setEditForm({ ...editForm, contact: e.target.value })}\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Maps URL</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                                value={editForm.locationUrl}\r\n                                                onChange={e => setEditForm({ ...editForm, locationUrl: e.target.value })}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Price Policy / Deposit</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                                value={editForm.advanceDeposit}\r\n                                                onChange={e => setEditForm({ ...editForm, advanceDeposit: e.target.value })}\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Security/Other Details</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                                value={editForm.security}\r\n                                                onChange={e => setEditForm({ ...editForm, security: e.target.value })}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <MultiSelectDropdown\r\n                                            label=\"Mess Amenities\"\r\n                                            options={[\r\n                                                { key: 'food', label: 'Food' },\r\n                                                { key: 'wifi', label: 'WiFi' },\r\n                                                { key: 'inverter', label: 'Electricity Backup' }\r\n                                            ]}\r\n                                            selected={editForm.amenities}\r\n                                            onChange={(key, checked) => setEditForm({\r\n                                                ...editForm,\r\n                                                amenities: { ...editForm.amenities, [key]: checked }\r\n                                            })}\r\n                                            color=\"indigo\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"p-4 bg-slate-900/50 rounded-2xl border border-slate-700 flex flex-col gap-4\">\r\n                                        <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                className=\"w-5 h-5 accent-indigo-500\"\r\n                                                checked={editForm.hidden}\r\n                                                onChange={e => setEditForm({ ...editForm, hidden: e.target.checked })}\r\n                                            />\r\n                                            <div>\r\n                                                <span className=\"text-sm font-bold text-white\">Private Listing</span>\r\n                                                <p className=\"text-[10px] text-slate-500\">Hide this mess from the public home page</p>\r\n                                            </div>\r\n                                        </label>\r\n\r\n                                        <label className=\"flex items-center gap-3 cursor-pointer border-t border-slate-700/50 pt-3\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                className=\"w-5 h-5 accent-indigo-500\"\r\n                                                checked={editForm.hideContact}\r\n                                                onChange={e => setEditForm({ ...editForm, hideContact: e.target.checked })}\r\n                                            />\r\n                                            <div>\r\n                                                <span className=\"text-sm font-bold text-white\">Hide Contact Number</span>\r\n                                                <p className=\"text-[10px] text-slate-500\">Show \"Not Available\" instead of phone number</p>\r\n                                            </div>\r\n                                        </label>\r\n                                    </div>\r\n\r\n                                    <div className=\"p-4 bg-slate-900/50 rounded-2xl border border-slate-700\">\r\n                                        <div className=\"flex items-center gap-3 mb-4\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                className=\"w-5 h-5 accent-amber-500\"\r\n                                                checked={editForm.isUserSourced}\r\n                                                onChange={e => setEditForm({ ...editForm, isUserSourced: e.target.checked })}\r\n                                            />\r\n                                            <span className=\"text-sm font-bold text-white\">Managed (User Sourced)</span>\r\n                                        </div>\r\n                                        {editForm.isUserSourced && (\r\n                                            <div>\r\n                                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Last Update Date</label>\r\n                                                <input\r\n                                                    type=\"date\"\r\n                                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-amber-500\"\r\n                                                    value={editForm.lastUpdatedDate}\r\n                                                    onChange={e => setEditForm({ ...editForm, lastUpdatedDate: e.target.value })}\r\n                                                    required\r\n                                                />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Poster Image</label>\r\n                                        <input\r\n                                            type=\"file\"\r\n                                            className=\"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-indigo-500/10 file:text-indigo-400 hover:file:bg-indigo-500/20\"\r\n                                            onChange={e => setEditImageFiles(e.target.files)}\r\n                                            accept=\"image/*\"\r\n                                        />\r\n                                    </div>\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Occupancy</label>\r\n                                            <select\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-cyan-500\"\r\n                                                value={editForm.occupancy}\r\n                                                onChange={e => setEditForm({ ...editForm, occupancy: e.target.value })}\r\n                                            >\r\n                                                <option value=\"Single\">Single</option>\r\n                                                <option value=\"Double\">Double</option>\r\n                                                <option value=\"Triple\">Triple</option>\r\n                                                <option value=\"Four\">Four</option>\r\n                                                <option value=\"Five\">Five</option>\r\n                                                <option value=\"Six\">Six</option>\r\n                                            </select>\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Price (â‚¹/mo)</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-cyan-500\"\r\n                                                value={editForm.price}\r\n                                                onChange={e => setEditForm({ ...editForm, price: e.target.value })}\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Total Inventory</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-cyan-500\"\r\n                                                value={editForm.totalInventory}\r\n                                                onChange={e => setEditForm({ ...editForm, totalInventory: e.target.value })}\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Available Seats/Beds</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-cyan-500\"\r\n                                                value={editForm.availableCount}\r\n                                                onChange={e => setEditForm({ ...editForm, availableCount: e.target.value })}\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">Category / Other Info</label>\r\n                                        <textarea\r\n                                            placeholder=\"e.g. Deluxe AC, includes study table\"\r\n                                            className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white outline-none focus:ring-2 focus:ring-cyan-500 h-20 resize-none\"\r\n                                            value={editForm.category}\r\n                                            onChange={e => setEditForm({ ...editForm, category: e.target.value })}\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <MultiSelectDropdown\r\n                                            label=\"Room Amenities\"\r\n                                            options={[\r\n                                                { key: 'ac', label: 'AC' },\r\n                                                { key: 'attachedBathroom', label: 'Attached Bathroom' }\r\n                                            ]}\r\n                                            selected={editForm.amenities}\r\n                                            onChange={(key, checked) => setEditForm({\r\n                                                ...editForm,\r\n                                                amenities: { ...editForm.amenities, [key]: checked }\r\n                                            })}\r\n                                            color=\"cyan\"\r\n                                        />\r\n                                    </div>\r\n                                </>\r\n                            )}\r\n\r\n                            <div className=\"pt-4 flex gap-3\">\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={isSaving}\r\n                                    className=\"flex-1 bg-indigo-500 hover:bg-indigo-600 disabled:bg-indigo-500/50 text-white font-bold py-3 rounded-2xl transition-all shadow-lg shadow-indigo-500/20 active:scale-95 flex items-center justify-center gap-2\"\r\n                                >\r\n                                    {isSaving ? 'Saving Changes...' : 'Save Changes'}\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => { setEditingItem(null); setEditForm(null); }}\r\n                                    className=\"px-6 bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-3 rounded-2xl transition-all border border-slate-600\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default OperationalDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\OperationalLogin.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'createUserWithEmailAndPassword' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":2,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":68,"suggestions":[{"messageId":"removeVar","data":{"varName":"createUserWithEmailAndPassword"},"fix":{"range":[77,109],"text":""},"desc":"Remove unused variable 'createUserWithEmailAndPassword'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'firebase/auth';\r\nimport { auth } from '../firebase';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { ShieldCheck, Server } from 'lucide-react';\r\n\r\nconst OperationalLogin = () => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n    const navigate = useNavigate();\r\n\r\n    const ALLOWED_OPERATOR_EMAIL = import.meta.env.VITE_OP_EMAIL;\r\n\r\n    const handleLogin = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n\r\n        if (!ALLOWED_OPERATOR_EMAIL) {\r\n            setError(\"Configuration Error: No Operator Email set in environment.\");\r\n            return;\r\n        }\r\n\r\n        if (email !== ALLOWED_OPERATOR_EMAIL) {\r\n            setError(\"Access Denied: You are not authorized to access this interface.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await signInWithEmailAndPassword(auth, email, password);\r\n            navigate('/operational/dashboard');\r\n        } catch (err) {\r\n            console.error(\"Login Error:\", err);\r\n            setError(\"Invalid credentials or server error.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-900 px-4\">\r\n            <div className=\"bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700\">\r\n                <div className=\"text-center mb-8\">\r\n                    <div className=\"bg-emerald-500/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-500\">\r\n                        <Server size={32} />\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold text-white\">Operational Access</h2>\r\n                    <p className=\"text-slate-400\">Restricted to Authorized Operators Only</p>\r\n                </div>\r\n\r\n                {error && (\r\n                    <div className=\"bg-red-500/10 border border-red-500/20 text-red-500 p-3 rounded-lg mb-4 text-sm text-center\">\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                <form onSubmit={handleLogin} className=\"space-y-6\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-300 mb-1\">Operator Email</label>\r\n                        <input\r\n                            type=\"email\"\r\n                            required\r\n                            className=\"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all\"\r\n                            value={email}\r\n                            onChange={(e) => setEmail(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-300 mb-1\">Password</label>\r\n                        <input\r\n                            type=\"password\"\r\n                            required\r\n                            className=\"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all\"\r\n                            value={password}\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <button\r\n                        type=\"submit\"\r\n                        className=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 rounded-lg transition-colors shadow-lg shadow-emerald-900/20\"\r\n                    >\r\n                        Authenticate\r\n                    </button>\r\n\r\n                </form>\r\n\r\n                <div className=\"mt-6 text-center\">\r\n                    <a href=\"/\" className=\"text-xs text-slate-500 hover:text-slate-400 transition-colors\">\r\n                        â† Exit to Public Site\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default OperationalLogin;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\RoomDetails.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[445,452],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleBookClick', 'searchParams', and 'setSearchParams'. Either include them or remove the dependency array.","line":58,"column":8,"nodeType":"ArrayExpression","endLine":58,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [currentUser, handleBookClick, loading, searchParams, setSearchParams]","fix":{"range":[2368,2390],"text":"[currentUser, handleBookClick, loading, searchParams, setSearchParams]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { db } from '../firebase';\r\nimport { doc, getDoc, collection, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { MapPin, Wifi, Zap, CheckCircle, ArrowLeft, BedDouble, Wind, Droplets, Utensils, Star, Shield, Lock } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport PhoneCollectionModal from '../components/PhoneCollectionModal';\r\n\r\nconst RoomDetails = () => {\r\n    const { messId, roomId } = useParams();\r\n    const navigate = useNavigate();\r\n    const { currentUser, userRole } = useAuth();\r\n\r\n    const [mess, setMess] = useState(null);\r\n    const [room, setRoom] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [bookingProcessing, setBookingProcessing] = useState(false);\r\n    const [showConfirmModal, setShowConfirmModal] = useState(false);\r\n    const [showPhoneModal, setShowPhoneModal] = useState(false);\r\n    const [userPhone, setUserPhone] = useState('');\r\n\r\n\r\n    useEffect(() => {\r\n        const fetchDetails = async () => {\r\n            try {\r\n                // Fetch Mess\r\n                const messDoc = await getDoc(doc(db, \"messes\", messId));\r\n                if (messDoc.exists()) {\r\n                    setMess({ id: messDoc.id, ...messDoc.data() });\r\n                }\r\n\r\n                // Fetch Room\r\n                const roomDoc = await getDoc(doc(db, \"rooms\", roomId));\r\n                if (roomDoc.exists()) {\r\n                    setRoom({ id: roomDoc.id, ...roomDoc.data() });\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error details:\", error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchDetails();\r\n    }, [messId, roomId]);\r\n\r\n    const [searchParams, setSearchParams] = useSearchParams();\r\n\r\n    useEffect(() => {\r\n        if (!loading && currentUser && searchParams.get('action') === 'book') {\r\n            handleBookClick();\r\n            // Clear the param to prevent re-triggering\r\n            const newParams = new URLSearchParams(searchParams);\r\n            newParams.delete('action');\r\n            setSearchParams(newParams, { replace: true });\r\n        }\r\n    }, [currentUser, loading]);\r\n\r\n    const handleBookClick = async () => {\r\n        if (!currentUser) {\r\n            // Redirect to Login with return URL ensuring action=book is preserved\r\n            const returnUrl = `/room/${messId}/${roomId}?action=book`;\r\n            console.log('ðŸ”— Redirecting to login with return URL:', returnUrl);\r\n            navigate(`/user-login?redirect=${encodeURIComponent(returnUrl)}`);\r\n            return;\r\n        }\r\n        if (userRole !== 'user') {\r\n            alert(\"Partners cannot book rooms. Please login as a User.\");\r\n            return;\r\n        }\r\n\r\n        // Check if user has a phone number\r\n        const userDoc = await getDoc(doc(db, \"users\", currentUser.uid));\r\n        const userData = userDoc.exists() ? userDoc.data() : {};\r\n        const phone = userData.phone || '';\r\n\r\n        if (!phone || phone === 'N/A') {\r\n            // No phone - show phone collection modal\r\n            setShowPhoneModal(true);\r\n        } else {\r\n            // Has phone - proceed to booking confirmation\r\n            setUserPhone(phone);\r\n            setShowConfirmModal(true);\r\n        }\r\n    };\r\n\r\n    const handleConfirmBooking = async () => {\r\n        setBookingProcessing(true);\r\n        try {\r\n            const userDoc = await getDoc(doc(db, \"users\", currentUser.uid));\r\n            const userData = userDoc.exists() ? userDoc.data() : {};\r\n\r\n            await addDoc(collection(db, \"bookings\"), {\r\n                userId: currentUser.uid,\r\n                userName: userData.name || currentUser.displayName || \"User\",\r\n                userPhone: userPhone || userData.phone || \"N/A\",\r\n                messId: mess.id,\r\n                messName: mess.name,\r\n                roomId: room.id,\r\n                roomType: room.occupancy || \"Standard\",\r\n                price: room.price,\r\n                status: 'pending',\r\n                createdAt: serverTimestamp()\r\n            });\r\n            setShowConfirmModal(false);\r\n            navigate('/booking-success');\r\n        } catch (error) {\r\n            console.error(\"Booking failed:\", error);\r\n            alert(\"Booking failed. Please try again.\");\r\n        } finally {\r\n            setBookingProcessing(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center\">Loading details...</div>;\r\n    if (!mess || !room) return <div className=\"p-10 text-center\">Details not found.</div>;\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-brand-secondary pb-20\">\r\n            {/* Header / Nav */}\r\n            <div className=\"sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-brand-light-gray px-4 py-3 flex items-center gap-4\">\r\n                <button onClick={() => navigate(-1)} className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\">\r\n                    <ArrowLeft size={20} className=\"text-brand-text-dark\" />\r\n                </button>\r\n                <h1 className=\"text-lg font-bold text-brand-text-dark truncate\">Room Details</h1>\r\n            </div>\r\n\r\n            <div className=\"max-w-4xl mx-auto p-4 md:p-6 space-y-6\">\r\n\r\n                {/* Image Gallery */}\r\n                <div className=\"bg-white rounded-2xl p-2 shadow-sm border border-brand-light-gray overflow-hidden\">\r\n                    {room.imageUrls && room.imageUrls.length > 0 ? (\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <img src={room.imageUrls[0]} alt=\"Room Main\" className=\"w-full h-64 object-cover rounded-xl col-span-2\" />\r\n                            {room.imageUrls.slice(1, 3).map((url, idx) => (\r\n                                <img key={idx} src={url} alt={`Room ${idx + 1}`} className=\"w-full h-32 object-cover rounded-xl\" />\r\n                            ))}\r\n                        </div>\r\n                    ) : (\r\n                        <img src={room.imageUrl || \"/default-room.jpg\"} alt=\"Room\" className=\"w-full h-64 object-cover rounded-xl\" />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Title & Price */}\r\n                <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-brand-light-gray flex flex-col md:flex-row justify-between md:items-center gap-4\">\r\n                    <div>\r\n                        <div className=\"flex items-center gap-2 mb-1\">\r\n                            <h2 className=\"text-2xl font-bold text-brand-text-dark\">{({\r\n                                'Single': '1',\r\n                                'Double': '2',\r\n                                'Triple': '3',\r\n                                'Four': '4',\r\n                                'Five': '5',\r\n                                'Six': '6'\r\n                            })[room.occupancy] || room.occupancy} Seater</h2>\r\n                            <span className=\"bg-brand-accent-green/10 text-brand-accent-green text-xs font-bold px-2 py-0.5 rounded-full border border-brand-accent-green/20\">\r\n                                {room.category || 'Standard'}\r\n                            </span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 text-brand-text-gray\">\r\n                            <MapPin size={16} className=\"text-brand-primary\" />\r\n                            <span className=\"font-medium text-brand-primary\">{mess.name}</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"text-left md:text-right\">\r\n                        <div className=\"text-3xl font-black text-brand-text-dark\">â‚¹{room.price}<span className=\"text-sm font-medium text-gray-400\">/mo</span></div>\r\n                        <p className=\"text-xs text-green-600 font-bold bg-green-50 inline-block px-2 py-1 rounded mt-1\">\r\n                            {room.availableCount > 0 ? `${room.availableCount} Beds Available` : 'Sold Out'}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Amenities */}\r\n                <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-brand-light-gray\">\r\n                    <h3 className=\"text-lg font-bold text-brand-text-dark mb-4\">Amenities</h3>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        {room.amenities?.ac && (\r\n                            <div className=\"flex flex-col items-center justify-center p-4 bg-blue-50 text-blue-600 rounded-xl border border-blue-100\">\r\n                                <Wind size={24} className=\"mb-2\" />\r\n                                <span className=\"text-sm font-bold\">AC</span>\r\n                            </div>\r\n                        )}\r\n                        {room.amenities?.attachedBathroom && (\r\n                            <div className=\"flex flex-col items-center justify-center p-4 bg-cyan-50 text-cyan-600 rounded-xl border border-cyan-100\">\r\n                                <Droplets size={24} className=\"mb-2\" />\r\n                                <span className=\"text-sm font-bold\">Bathroom</span>\r\n                            </div>\r\n                        )}\r\n                        {mess.amenities?.wifi && (\r\n                            <div className=\"flex flex-col items-center justify-center p-4 bg-indigo-50 text-indigo-600 rounded-xl border border-indigo-100\">\r\n                                <Wifi size={24} className=\"mb-2\" />\r\n                                <span className=\"text-sm font-bold\">Wi-Fi</span>\r\n                            </div>\r\n                        )}\r\n                        {mess.amenities?.food && (\r\n                            <div className=\"flex flex-col items-center justify-center p-4 bg-orange-50 text-orange-600 rounded-xl border border-orange-100\">\r\n                                <Utensils size={24} className=\"mb-2\" />\r\n                                <span className=\"text-sm font-bold\">Food</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-brand-light-gray\">\r\n                    <h3 className=\"text-lg font-bold text-brand-text-dark mb-2\">Description</h3>\r\n                    <p className=\"text-gray-600 leading-relaxed\">\r\n                        {room.otherInfo || \"No additional description provided for this room.\"}\r\n                    </p>\r\n\r\n                    <div className=\"mt-6 pt-6 border-t border-gray-100 grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div>\r\n                            <h4 className=\"font-bold text-gray-900 mb-2\">Mess Rules</h4>\r\n                            <ul className=\"list-disc list-inside text-sm text-gray-600 space-y-1\">\r\n                                <li>Deposit: {mess.advanceDeposit || 'Contact Owner'}</li>\r\n                                <li>Type: {mess.messType}</li>\r\n                            </ul>\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"font-bold text-gray-900 mb-2\">Facilities</h4>\r\n                            <ul className=\"list-disc list-inside text-sm text-gray-600 space-y-1\">\r\n                                <li>{mess.foodFacility || 'Standard Menu'}</li>\r\n                                <li>{mess.extraAppliances || 'No heavy appliances'}</li>\r\n                                <li>{mess.security || 'Standard Security'}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Bottom Action Bar */}\r\n            <div className=\"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 px-6 md:hidden z-20 flex justify-between items-center shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]\">\r\n                <div>\r\n                    <p className=\"text-xs text-gray-500 font-bold uppercase\">Total Rent</p>\r\n                    <p className=\"text-2xl font-black text-brand-text-dark\">â‚¹{room.price}</p>\r\n                </div>\r\n                <button\r\n                    onClick={handleBookClick}\r\n                    disabled={room.availableCount <= 0}\r\n                    className=\"bg-brand-primary text-white px-8 py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-brand-primary-hover active:scale-95 transition-all disabled:bg-gray-300 disabled:shadow-none\"\r\n                >\r\n                    {room.availableCount > 0 ? 'Request Booking' : 'Sold Out'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Desktop Action Button (Floating) */}\r\n            <div className=\"hidden md:block fixed bottom-8 right-8 z-30\">\r\n                <button\r\n                    onClick={handleBookClick}\r\n                    disabled={room.availableCount <= 0}\r\n                    className=\"bg-brand-primary text-white px-10 py-4 rounded-2xl font-bold text-xl shadow-2xl hover:bg-brand-primary-hover hover:scale-105 transition-all disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-3\"\r\n                >\r\n                    {room.availableCount > 0 ? (\r\n                        <>\r\n                            <span>Request Booking</span>\r\n                            <div className=\"w-px h-6 bg-white/20\"></div>\r\n                            <span className=\"font-normal text-white/80\">â‚¹{room.price}</span>\r\n                        </>\r\n                    ) : 'Sold Out'}\r\n                </button>\r\n            </div>\r\n\r\n\r\n            {/* Confirmation Modal */}\r\n            <AnimatePresence>\r\n                {showConfirmModal && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\"\r\n                            onClick={() => setShowConfirmModal(false)}\r\n                        />\r\n                        <motion.div\r\n                            initial={{ scale: 0.9, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            exit={{ scale: 0.9, opacity: 0 }}\r\n                            className=\"bg-white w-full max-w-sm rounded-3xl p-6 relative z-10 shadow-2xl\"\r\n                        >\r\n                            <div className=\"text-center mb-6\">\r\n                                <div className=\"w-16 h-16 bg-brand-primary/10 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-primary\">\r\n                                    <CheckCircle size={32} />\r\n                                </div>\r\n                                <h3 className=\"text-2xl font-bold text-brand-text-dark\">Confirm Booking?</h3>\r\n                                <p className=\"text-gray-500 mt-2 text-sm\">\r\n                                    You are sending a booking request for <strong>{mess.name}</strong>.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-50 rounded-xl p-4 mb-6 space-y-3\">\r\n                                <div className=\"flex justify-between text-sm\">\r\n                                    <span className=\"text-gray-500\">Room Type</span>\r\n                                    <span className=\"font-bold text-gray-900\">{({\r\n                                        'Single': '1',\r\n                                        'Double': '2',\r\n                                        'Triple': '3',\r\n                                        'Four': '4',\r\n                                        'Five': '5',\r\n                                        'Six': '6'\r\n                                    })[room.occupancy] || room.occupancy} Seater</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between text-sm\">\r\n                                    <span className=\"text-gray-500\">Price</span>\r\n                                    <span className=\"font-bold text-gray-900\">â‚¹{room.price}/mo</span>\r\n                                </div>\r\n                                <div className=\"border-t border-gray-200 mt-2 pt-2 flex justify-between text-sm\">\r\n                                    <span className=\"text-gray-500\">Your Contact</span>\r\n                                    <span className=\"font-bold text-gray-900\">{currentUser.email}</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={() => setShowConfirmModal(false)}\r\n                                    className=\"flex-1 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-xl transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleConfirmBooking}\r\n                                    disabled={bookingProcessing}\r\n                                    className=\"flex-1 py-3 bg-brand-primary hover:bg-brand-primary-hover text-white font-bold rounded-xl transition-colors shadow-lg disabled:opacity-70\"\r\n                                >\r\n                                    {bookingProcessing ? 'Sending...' : 'Confirm'}\r\n                                </button>\r\n                            </div>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Phone Collection Modal */}\r\n            {showPhoneModal && currentUser && (\r\n                <PhoneCollectionModal\r\n                    user={currentUser}\r\n                    onClose={(phone) => {\r\n                        setUserPhone(phone);\r\n                        setShowPhoneModal(false);\r\n                        setShowConfirmModal(true); // Proceed to booking confirmation\r\n                    }}\r\n                    onSkip={() => {\r\n                        setShowPhoneModal(false);\r\n                        // Don't proceed to booking without phone\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default RoomDetails;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\UserLogin.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'phone' is defined but never used.","line":195,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":195,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"phone"},"fix":{"range":[9845,9850],"text":""},"desc":"Remove unused variable 'phone'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from 'firebase/auth';\r\nimport { auth, db } from '../firebase';\r\nimport { doc, setDoc, getDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { useNavigate, Link, useSearchParams } from 'react-router-dom';\r\nimport { Mail, Lock, ArrowLeft } from 'lucide-react';\r\nimport PhoneCollectionModal from '../components/PhoneCollectionModal';\r\n\r\nconst UserLogin = () => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [showPhoneModal, setShowPhoneModal] = useState(false);\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const navigate = useNavigate();\r\n    const [searchParams] = useSearchParams();\r\n    const redirectUrl = searchParams.get('redirect') || '/profile';\r\n\r\n    const handleGoogleSignIn = async () => {\r\n        setError('');\r\n        setLoading(true);\r\n\r\n        try {\r\n            const provider = new GoogleAuthProvider();\r\n            const result = await signInWithPopup(auth, provider);\r\n            const user = result.user;\r\n\r\n            // Check if user document exists, if not create one\r\n            const userDocRef = doc(db, \"users\", user.uid);\r\n            const userDoc = await getDoc(userDocRef);\r\n\r\n            let needsPhone = false;\r\n            if (!userDoc.exists()) {\r\n                // New user - create document\r\n                await setDoc(userDocRef, {\r\n                    uid: user.uid,\r\n                    name: user.displayName || 'User',\r\n                    email: user.email,\r\n                    phone: user.phoneNumber || '',\r\n                    role: 'user',\r\n                    createdAt: serverTimestamp()\r\n                });\r\n                needsPhone = !user.phoneNumber; // Check if Google provided phone\r\n            } else {\r\n                // Existing user - check if phone is missing\r\n                const userData = userDoc.data();\r\n                needsPhone = !userData.phone || userData.phone === '';\r\n            }\r\n\r\n            // If phone is missing, show modal; otherwise navigate\r\n            if (needsPhone) {\r\n                setCurrentUser(user);\r\n                setShowPhoneModal(true);\r\n            } else {\r\n                navigate(redirectUrl);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Google Sign-In Error:\", err);\r\n            let msg = \"Failed to sign in with Google.\";\r\n            if (err.code === 'auth/popup-closed-by-user') msg = \"Sign-in cancelled.\";\r\n            if (err.code === 'auth/popup-blocked') msg = \"Popup blocked. Please allow popups.\";\r\n            setError(msg);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleLogin = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        setLoading(true);\r\n\r\n        try {\r\n            await signInWithEmailAndPassword(auth, email, password);\r\n            navigate(redirectUrl);\r\n        } catch (err) {\r\n            console.error(\"Login Error:\", err);\r\n            let msg = \"Failed to login.\";\r\n            if (err.code === 'auth/invalid-credential') msg = \"Invalid email or password.\";\r\n            setError(msg);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-brand-secondary px-4\">\r\n            <div className=\"bg-white p-8 rounded-2xl shadow-xl w-full max-w-md relative overflow-hidden\">\r\n                <button\r\n                    onClick={() => navigate('/')}\r\n                    className=\"absolute top-4 left-4 flex items-center gap-1 text-xs font-bold text-gray-400 hover:text-brand-primary transition-colors uppercase tracking-wider group\"\r\n                >\r\n                    <ArrowLeft size={14} className=\"group-hover:-translate-x-1 transition-transform\" />\r\n                    Back to Home\r\n                </button>\r\n\r\n                <div className=\"text-center mb-8 mt-4\">\r\n                    <h2 className=\"text-3xl font-bold text-brand-text-dark mb-2\">Welcome Back</h2>\r\n                    <p className=\"text-brand-text-gray\">Login to access your bookings</p>\r\n                </div>\r\n\r\n                {error && (\r\n                    <div className=\"bg-red-50 text-red-600 p-3 rounded-lg mb-6 text-sm text-center\">\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Google Sign-In Button */}\r\n                <button\r\n                    onClick={handleGoogleSignIn}\r\n                    type=\"button\"\r\n                    disabled={loading}\r\n                    className=\"w-full flex items-center justify-center gap-3 bg-white hover:bg-gray-50 text-gray-700 font-semibold py-3 rounded-lg border-2 border-gray-200 transition-all shadow-sm hover:shadow-md disabled:opacity-70 disabled:cursor-not-allowed\"\r\n                >\r\n                    <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n                        <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" />\r\n                        <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" />\r\n                        <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" />\r\n                        <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" />\r\n                    </svg>\r\n                    {loading ? 'Signing in...' : 'Continue with Google'}\r\n                </button>\r\n\r\n                {/* Divider */}\r\n                <div className=\"relative my-6\">\r\n                    <div className=\"absolute inset-0 flex items-center\">\r\n                        <div className=\"w-full border-t border-gray-200\"></div>\r\n                    </div>\r\n                    <div className=\"relative flex justify-center text-sm\">\r\n                        <span className=\"px-4 bg-white text-gray-500 font-medium\">OR</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <form onSubmit={handleLogin} className=\"space-y-5\">\r\n                    {/* Email */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-brand-text-dark mb-1\">Email Address</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                <Mail size={18} className=\"text-gray-400\" />\r\n                            </div>\r\n                            <input\r\n                                type=\"email\"\r\n                                required\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition-all\"\r\n                                placeholder=\"you@example.com\"\r\n                                value={email}\r\n                                onChange={(e) => setEmail(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Password */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-brand-text-dark mb-1\">Password</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                <Lock size={18} className=\"text-gray-400\" />\r\n                            </div>\r\n                            <input\r\n                                type=\"password\"\r\n                                required\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition-all\"\r\n                                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                value={password}\r\n                                onChange={(e) => setPassword(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={loading}\r\n                        className=\"w-full bg-brand-primary hover:bg-brand-primary-hover text-white font-bold py-3 rounded-lg transition-colors shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {loading ? 'Logging In...' : 'Log In'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div className=\"mt-6 text-center text-sm text-gray-600\">\r\n                    Don't have an account?{' '}\r\n                    <Link\r\n                        to={redirectUrl !== '/profile' ? `/user-signup?redirect=${encodeURIComponent(redirectUrl)}` : '/user-signup'}\r\n                        className=\"text-brand-primary font-semibold hover:underline\"\r\n                    >\r\n                        Sign up\r\n                    </Link>\r\n                </div>\r\n\r\n                {/* Phone Collection Modal */}\r\n                {showPhoneModal && currentUser && (\r\n                    <PhoneCollectionModal\r\n                        user={currentUser}\r\n                        onClose={(phone) => {\r\n                            setShowPhoneModal(false);\r\n                            navigate(redirectUrl);\r\n                        }}\r\n                        onSkip={() => {\r\n                            setShowPhoneModal(false);\r\n                            navigate(redirectUrl);\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default UserLogin;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\UserProfile.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\src\\pages\\UserSignup.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'phone' is defined but never used.","line":259,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":259,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"phone"},"fix":{"range":[12924,12929],"text":""},"desc":"Remove unused variable 'phone'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from 'firebase/auth';\r\nimport { auth, db } from '../firebase';\r\nimport { setDoc, doc, serverTimestamp, getDoc } from 'firebase/firestore';\r\nimport { useNavigate, Link, useSearchParams } from 'react-router-dom';\r\nimport { User, Mail, Lock, Phone, ArrowLeft } from 'lucide-react';\r\nimport PhoneCollectionModal from '../components/PhoneCollectionModal';\r\n\r\nconst UserSignup = () => {\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        email: '',\r\n        password: '',\r\n        phone: ''\r\n    });\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [showPhoneModal, setShowPhoneModal] = useState(false);\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const navigate = useNavigate();\r\n    const [searchParams] = useSearchParams();\r\n    const redirectUrl = searchParams.get('redirect') || '/profile';\r\n\r\n    console.log('ðŸ”— UserSignup redirectUrl:', redirectUrl);\r\n\r\n    const handleChange = (e) => {\r\n        setFormData({ ...formData, [e.target.name]: e.target.value });\r\n    };\r\n\r\n    const handleGoogleSignIn = async () => {\r\n        setError('');\r\n        setLoading(true);\r\n\r\n        try {\r\n            const provider = new GoogleAuthProvider();\r\n            const result = await signInWithPopup(auth, provider);\r\n            const user = result.user;\r\n\r\n            // Check if user document exists, if not create one\r\n            const userDocRef = doc(db, \"users\", user.uid);\r\n            const userDoc = await getDoc(userDocRef);\r\n\r\n            let needsPhone = false;\r\n            if (!userDoc.exists()) {\r\n                // New user - create document with Google profile data\r\n                await setDoc(userDocRef, {\r\n                    uid: user.uid,\r\n                    name: user.displayName || 'User',\r\n                    email: user.email,\r\n                    phone: user.phoneNumber || '',\r\n                    role: 'user',\r\n                    createdAt: serverTimestamp()\r\n                });\r\n                needsPhone = !user.phoneNumber;\r\n            } else {\r\n                // Existing user - check if phone is missing\r\n                const userData = userDoc.data();\r\n                needsPhone = !userData.phone || userData.phone === '';\r\n            }\r\n\r\n            // If phone is missing, show modal; otherwise navigate\r\n            if (needsPhone) {\r\n                setCurrentUser(user);\r\n                setShowPhoneModal(true);\r\n            } else {\r\n                navigate(redirectUrl);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Google Sign-In Error:\", err);\r\n            let msg = \"Failed to sign in with Google.\";\r\n            if (err.code === 'auth/popup-closed-by-user') msg = \"Sign-in cancelled.\";\r\n            if (err.code === 'auth/popup-blocked') msg = \"Popup blocked. Please allow popups.\";\r\n            setError(msg);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSignup = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        setLoading(true);\r\n\r\n        try {\r\n            // 1. Create Auth User\r\n            const userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);\r\n            const user = userCredential.user;\r\n\r\n            // 2. Create User Document in Firestore\r\n            await setDoc(doc(db, \"users\", user.uid), {\r\n                uid: user.uid,\r\n                name: formData.name,\r\n                email: formData.email,\r\n                phone: formData.phone,\r\n                role: 'user',\r\n                createdAt: serverTimestamp()\r\n            });\r\n\r\n            // 3. Navigate to redirect URL or Profile\r\n            console.log('âœ… Signup successful! Redirecting to:', redirectUrl);\r\n            navigate(redirectUrl);\r\n\r\n        } catch (err) {\r\n            console.error(\"Signup Error:\", err);\r\n            let msg = \"Failed to sign up.\";\r\n            if (err.code === 'auth/email-already-in-use') msg = \"Email is already in use.\";\r\n            if (err.code === 'auth/weak-password') msg = \"Password should be at least 6 characters.\";\r\n            setError(msg);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-brand-secondary px-4 py-12\">\r\n            <div className=\"bg-white p-8 rounded-2xl shadow-xl w-full max-w-md relative overflow-hidden\">\r\n                <button\r\n                    onClick={() => navigate('/')}\r\n                    className=\"absolute top-4 left-4 flex items-center gap-1 text-xs font-bold text-gray-400 hover:text-brand-primary transition-colors uppercase tracking-wider group\"\r\n                >\r\n                    <ArrowLeft size={14} className=\"group-hover:-translate-x-1 transition-transform\" />\r\n                    Back to Home\r\n                </button>\r\n\r\n                <div className=\"text-center mb-8 mt-4\">\r\n                    <h2 className=\"text-3xl font-bold text-brand-text-dark mb-2\">Create Account</h2>\r\n                    <p className=\"text-brand-text-gray\">Join Mess Khojo to book your stay</p>\r\n                </div>\r\n\r\n                {error && (\r\n                    <div className=\"bg-red-50 text-red-600 p-3 rounded-lg mb-6 text-sm text-center\">\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Google Sign-In Button */}\r\n                <button\r\n                    onClick={handleGoogleSignIn}\r\n                    type=\"button\"\r\n                    disabled={loading}\r\n                    className=\"w-full flex items-center justify-center gap-3 bg-white hover:bg-gray-50 text-gray-700 font-semibold py-3 rounded-lg border-2 border-gray-200 transition-all shadow-sm hover:shadow-md disabled:opacity-70 disabled:cursor-not-allowed\"\r\n                >\r\n                    <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n                        <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" />\r\n                        <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" />\r\n                        <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" />\r\n                        <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" />\r\n                    </svg>\r\n                    {loading ? 'Signing up...' : 'Sign up with Google'}\r\n                </button>\r\n\r\n                {/* Divider */}\r\n                <div className=\"relative my-6\">\r\n                    <div className=\"absolute inset-0 flex items-center\">\r\n                        <div className=\"w-full border-t border-gray-200\"></div>\r\n                    </div>\r\n                    <div className=\"relative flex justify-center text-sm\">\r\n                        <span className=\"px-4 bg-white text-gray-500 font-medium\">OR</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <form onSubmit={handleSignup} className=\"space-y-5\">\r\n                    {/* Name */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-brand-text-dark mb-1\">Full Name</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                <User size={18} className=\"text-gray-400\" />\r\n                            </div>\r\n                            <input\r\n                                name=\"name\"\r\n                                type=\"text\"\r\n                                required\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition-all\"\r\n                                placeholder=\"John Doe\"\r\n                                value={formData.name}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Phone */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-brand-text-dark mb-1\">Phone Number</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                <Phone size={18} className=\"text-gray-400\" />\r\n                            </div>\r\n                            <input\r\n                                name=\"phone\"\r\n                                type=\"tel\"\r\n                                required\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition-all\"\r\n                                placeholder=\"+91 98765 43210\"\r\n                                value={formData.phone}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Email */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-brand-text-dark mb-1\">Email Address</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                <Mail size={18} className=\"text-gray-400\" />\r\n                            </div>\r\n                            <input\r\n                                name=\"email\"\r\n                                type=\"email\"\r\n                                required\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition-all\"\r\n                                placeholder=\"you@example.com\"\r\n                                value={formData.email}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Password */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-brand-text-dark mb-1\">Password</label>\r\n                        <div className=\"relative\">\r\n                            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                                <Lock size={18} className=\"text-gray-400\" />\r\n                            </div>\r\n                            <input\r\n                                name=\"password\"\r\n                                type=\"password\"\r\n                                required\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition-all\"\r\n                                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                value={formData.password}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={loading}\r\n                        className=\"w-full bg-brand-primary hover:bg-brand-primary-hover text-white font-bold py-3 rounded-lg transition-colors shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {loading ? 'Creating Account...' : 'Sign Up'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div className=\"mt-6 text-center text-sm text-gray-600\">\r\n                    Already have an account?{' '}\r\n                    <Link to=\"/user-login\" className=\"text-brand-primary font-semibold hover:underline\">\r\n                        Log in\r\n                    </Link>\r\n                </div>\r\n\r\n                {/* Phone Collection Modal */}\r\n                {showPhoneModal && currentUser && (\r\n                    <PhoneCollectionModal\r\n                        user={currentUser}\r\n                        onClose={(phone) => {\r\n                            setShowPhoneModal(false);\r\n                            navigate(redirectUrl);\r\n                        }}\r\n                        onSkip={() => {\r\n                            setShowPhoneModal(false);\r\n                            navigate(redirectUrl);\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default UserSignup;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\barma\\.gemini\\antigravity\\scratch\\mess-khojo\\client\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]